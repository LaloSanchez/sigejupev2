<?php

ini_set('max_execution_time', 300);

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/respuestamuestra/RespuestamuestraDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/respuestamuestra/RespuestamuestraDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/solicitudesmuestras/SolicitudesmuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/solicitudesmuestras/SolicitudesmuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/carpetasjudiciales/CarpetasjudicialesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/carpetasjudiciales/CarpetasjudicialesDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/respuestamuestra/RespuestamuestraDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/respuestamuestra/RespuestamuestraDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/imputadosmuestras/ImputadosmuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/imputadosmuestras/ImputadosmuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/ofendidosmuestras/OfendidosmuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/ofendidosmuestras/OfendidosmuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/delitosmuestras/DelitosmuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/delitosmuestras/DelitosmuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/contadores/ContadoresDTO.Class.php");
include_once(dirname(__FILE__) . "/../contadores/ContadoresController.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/juzgadoresmuestras/JuzgadoresmuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/juzgadoresmuestras/JuzgadoresmuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/ministeriosresponsablesmuestras/MinisteriosresponsablesmuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/ministeriosresponsablesmuestras/MinisteriosresponsablesmuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/juzgados/JuzgadosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/juzgados/JuzgadosDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/juzgadores/JuzgadoresDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/juzgadores/JuzgadoresDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/tiposjuzgadores/TiposjuzgadoresDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/tiposjuzgadores/TiposjuzgadoresDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/estatussolicitudesmuestras/EstatussolicitudesmuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/estatussolicitudesmuestras/EstatussolicitudesmuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/tomamuestras/TomamuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/tomamuestras/TomamuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/generos/GenerosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/generos/GenerosDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/muestras/MuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/muestras/MuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/bitacoranotificaciones/BitacoranotificacionesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/bitacoranotificaciones/BitacoranotificacionesDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/bitacoramovimientos/BitacoramovimientosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/bitacoramovimientos/BitacoramovimientosDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/chatmessages/ChatMessagesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/chatmessages/ChatMessagesDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/chatcerrados/ChatCerradosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/chatcerrados/ChatCerradosDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../fachadas/sigejupe/imagenes/ImagenesFacade.Class.php");

//include_once(dirname(__FILE__) . "/../../../controladores/sigejupe/programacionrespmuestras/ProgramacionrespmuestrasController.Class.php");
//include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/programacionrespmuestras/ProgramacionrespmuestrasDTO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/telefonosjuzgadores/TelefonosjuzgadoresDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/telefonosjuzgadores/TelefonosjuzgadoresDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/tutoresofendidosmuestras/TutoresofendidosmuestrasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/tutoresofendidosmuestras/TutoresofendidosmuestrasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../webservice/cliente/usuarios/UsuarioCliente.php");
include_once(dirname(__FILE__) . "/../../../tribunal/pdf/html2pdf.class.php");
include_once(dirname(__FILE__) . "/../../../tribunal/selloDigital/Encryption.Class.php");

class ComprobanteMuestrasController {

    private $proveedor;

    public function __construct() {
        
    }

    public function generaComprobante($idMuestra = "", $cveFormato = "1") {
        #$cveFormato 1 = PFD , 2 = HTML
        #VALIDAOS LOS DATOS ENVIADOS
        if ($idMuestra != "" && $idMuestra > 0) {
            #INICAMOS PROCESO DE CONSULTA DE INFORMACION
            $error = false;

            #CONSULTAMOS INFORMACION DEL CATEO
            $RespMuestraDao = new RespuestaMuestraDAO();
            $RespMuestraDto = new RespuestaMuestraDTO();
            $RespMuestraDto->setIdMuestra($idMuestra);
            $RespMuestraDto = $RespMuestraDao->selectRespuestamuestra($RespMuestraDto);
            if ($RespMuestraDto != "" && count($RespMuestraDto) > 0) {
                $RespMuestraDto = $RespMuestraDto[0];
            } else {
                $error = true;
                $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO INFORMACION DE LA TOMA DE MUESTRA ESPECIFICADO");
            }

            if (!$error) {
                #CONSULTAMOS INFORMACION DE LA SOLICITUD
                $SolicitudesmuestrasDao = new SolicitudesmuestrasDAO();
                $SolicitudesmuestrasDto = new SolicitudesmuestrasDTO();
                $SolicitudesmuestrasDto->setIdSolicitudMuestra($RespMuestraDto->getIdSolicitudMuestra());
                $SolicitudesmuestrasDto = $SolicitudesmuestrasDao->selectSolicitudesmuestras($SolicitudesmuestrasDto);
                if ($SolicitudesmuestrasDto != "" && count($SolicitudesmuestrasDto) > 0) {
                    $SolicitudesmuestrasDto = $SolicitudesmuestrasDto[0];
                    #VERIFICAMOS SI EL ARCHIVO DEL CATEO YA EXISTE, SI EXISTE SOLO SE DESCARGA, SI NO EXISTE SE CREA PARA QUE SE DESCARGUE
                    if (file_exists("./../../../solicitudespdf/Respuesta_" . $RespMuestraDto->getQr() . ".pdf")) {
                        $tmp = array("type" => "OK",
                            "text" => "SE GENERO EL PDF DE LA SOLICTUD CORRECTAMENTE",
                            "fileName" => "Respuesta_" . str_pad($RespMuestraDto->getNumeroMuestra(), 6, '0', STR_PAD_LEFT) . "/" . $RespMuestraDto->getAnioMuestra() . '.pdf',
                            "file" => "Respuesta_" . $RespMuestraDto->getQr() . ".pdf");
                    } else {
                        $html = "";
                        if (!$error) {

                            $html = "";
                            $html.="<page backtop=\"50mm\" "
                                    . "backbottom=\"20mm\" "
                                    . "backleft=\"20mm\" "
                                    . "backright=\"20mm\" "
                                    . "backimg=\"img/imgFondo.jpg\" "
                                    . "backimgx=\"center\" "
                                    . "style='font-size: 10pt'>";
                            #PAGE HEADER
                            $html.="<page_header>";
                            $html.="<table style='width: 90%; border: solid 0px black;'>";
                            $html.="<tr>";
                            $html.="<td colspan='2' style='text-align: center; width: 100%'><img src='../../../vistas/img/encabezado.jpg'></td>\n";
                            $html.=" </tr>";

                            $html.="<tr>";
                            $html.="<td colspan='2' style='text-align: center; width: 100%;font-size: 8pt'></td>";
                            $html.="</tr>";
                            $html.="<tr>";
                            $html.="<td colspan='2' style='text-align: center; width: 100%;font-size: 8pt'>M&oacute;dulo de Solicitudes de Actos de Investigación que requieren Autorización Judicial (Toma de Muestras) del Sistema de Gesti&oacute;n Judicial Penal (SIGEJUPE) del Poder Judicial del Estado de M&eacute;xico</td>";
                            $html.="</tr>";
                        }

                        if (!$error) {
                            #CONSULTAMOS FECHA Y HORA DEL SERVIDOR DE BASE DE DATOS
                            $SolicitudesmuestrasDao = new SolicitudesmuestrasDAO();
                            $FechaHora = $SolicitudesmuestrasDao->selectFechaHora();
                            if ($FechaHora != "") {
                                
                            } else {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "NO SE PUDO OBTENER LA FECHA Y HORA DEL SERVIDOR");
                            }
                        }

                        if (!$error) {
                            $html.="<tr>";
                            $html.="<td style='text-align: right; width: 40%;font-size: 8pt'>Fecha y Hora de creaci&oacute;n de este archivo: " . $FechaHora . "</td>";
                            $html.="<td style='text-align: right; width: 60%;font-size: 10pt'>Pagina [[page_cu]] de [[page_nb]]</td>";
                            $html.=" </tr>";
                            $html.="<tr>";
                            $html.="<td style='width:40%; text-align: center' rowspan='1'>&nbsp;</td>";
                            $html.="<td style='width:60%; text-align: right; font-size: 9pt' colspan='1'><strong>N&uacute;mero Toma de Muestra:</strong> " . str_pad($RespMuestraDto->getNumeroMuestra(), 6, '0', STR_PAD_LEFT) . "/" . $RespMuestraDto->getAnioMuestra() . "</td>";

                            $html.="</tr>";
                            $html.="<tr>";
                            $html.="<td style='width:40%; text-align: center'>&nbsp;</td>";
                            $html.="<td style='width:60%; text-align: right; font-size: 9pt' colspan='1'><strong>Fecha de Solicitud:</strong> " . ucfirst(strtolower($this->FechaLarga($RespMuestraDto->getFechaRegistro()))) . "</td>";
                            $html.="</tr>";
                            $html.="<tr>";
                            $html.="<td style='width:40%; text-align: center'>&nbsp;</td>";

                            $html.="<td style='width:60%; text-align: right; font-size: 9pt' colspan='1'><strong>Fecha de Respuesta:</strong> " . ucfirst(strtolower($this->FechaLarga($RespMuestraDto->getFechaRespuesta()))) . "</td>";
                            $html.="</tr>";
                            $html.="<tr>";
                            $html.="<td style='width:40%; text-align: center'>&nbsp;</td>";
                            $html.="<td style='width:60%; text-align: center'>&nbsp;</td>";
                            $html.="</tr>";
                            $html.="</table>";
                            $html.="</page_header>";
                            #TERMINA PAGE HEADER

                            $totalCadena = strlen(trim($RespMuestraDto->getSelloDigital()));
                            $pag = ceil($totalCadena / 120);

                            #PAGE FOOTER
                            $html.="<page_footer>";
                            $html.="<table style='width: 100%; '>";
                            $html.="<tr>";
                            $html.="<td style='width:40%; text-align: center; font-size: 1pt'>Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;xico Poder Judicial del Estado de M&eacute;</td>";
                            $html.="</tr>";
                            $html.="<tr>";
                            $html.="<td style='text-align: left;    width: 100%;font-size: 8pt'>Firma Electrónica: </td>";
                            $html.="</tr>";
                            for ($index = 0; $index < $pag; $index++) {
                                $html.="<tr>";
                                $html.="<td style='text-align: left;    width: 100%;font-size: 8pt'>" . Trim(substr($RespMuestraDto->getSelloDigital(), ($index * 120), 120)) . "</td>";
                                $html.="</tr>";
                            }
                            $html.="</table>";
                            $html.="</page_footer>";
                            #TERMINA PAGE FOOTER

                            $html.= "<table cellspacing='1' cellpadding='2' style='width: 100%; text-align: left; font-size: 11pt;' border='0'>";
                            $html.="<tr>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="</tr>";
                        }

                        if (!$error) {
                            #DATOS JUZGADOS
                            $html.="<tr>";
                            $html.="<td style='width:100%; text-align: left; font-size: 10pt;' colspan='4' ><strong>Juzgado que resuelve: </strong>";
                            $JuzgadosDao = new JuzgadosDAO();
                            $JuzgadosDto = new JuzgadosDTO();
                            $JuzgadosDto->setCveJuzgado($SolicitudesmuestrasDto->getCveJuzgadoDesahoga());
                            $JuzgadosDto = $JuzgadosDao->selectJuzgados($JuzgadosDto);
                            if ($JuzgadosDto != "" && count($JuzgadosDto) > 0) {
                                $JuzgadosDto = $JuzgadosDto[0];
                                $html.="" . $JuzgadosDto->getDesJuzgado() . "";
                            } else {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO INFORMACION DEL JUZGADO DE LA SOLICITUD");
                            }
                            $html.="</td>";
                            $html.="</tr>";
                        }

                        if (!$error) {
                            if (((int) $SolicitudesmuestrasDto->getNumero() > 0)) {
                                $html.="<tr>";
                                $html.="<td style='width:100%; text-align: left; font-size: 10pt;' colspan='4'><strong>N&uacute;mero Causa:</strong>";
                                $html.=$SolicitudesmuestrasDto->getNumero() . "/" . $SolicitudesmuestrasDto->getAnio() . " <strong>del</strong> ";

                                $JuzgadosCausaDao = new JuzgadosDAO();
                                $JuzgadosCausaDto = new JuzgadosDTO();
                                $JuzgadosCausaDto->setCveJuzgado($SolicitudesmuestrasDto->getCveJuzgadoDesahoga());
                                $JuzgadosCausaDto = $JuzgadosCausaDao->selectJuzgados($JuzgadosCausaDto);
                                if ($JuzgadosCausaDto != "" && count($JuzgadosCausaDto) > 0) {
                                    $JuzgadosCausaDto = $JuzgadosCausaDto[0];
                                    $html.="" . $JuzgadosCausaDto->getDesJuzgado() . "";
                                } else {
                                    $error = true;
                                    $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO INFORMACION DEL JUZGADO DE LA CARPETA JUDICIAL");
                                }
                                $html.="</td>";
                                $html.="</tr>";
                            }

                            $html.="<tr>";
                            $html.="<td style='width:100%; text-align: left' colspan='4'><strong>Carpeta de investigaci&oacute;n: </strong>";
                            $html.=$SolicitudesmuestrasDto->getCarpetaInv() . "</td>";
                            $html.="</tr>";

                            $html.="<tr>";
                            $html.="<td style='width:100%; text-align: left' colspan='4'><strong>NUC: </strong>";
                            $html.=$SolicitudesmuestrasDto->getNuc() . "</td>";
                            $html.="</tr>";

                            $html.="<tr>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="</tr>";

                            $html.="<tr>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="</tr>";
                            #TERMINA DATOS JUZGADOS
                        }

                        if (!$error) {
                            #CONSULTAMOS RELACION SOLICITUD CATEO - JUZGADOR
                            $JuzgadoresmuestrasDao = new JuzgadoresmuestrasDAO();
                            $JuzgadoresmuestrasDto = new JuzgadoresmuestrasDTO();
                            $JuzgadoresmuestrasDto->setIdSolicitudMuestra($SolicitudesmuestrasDto->getIdSolicitudMuestra());
                            $JuzgadoresmuestrasDto = $JuzgadoresmuestrasDao->selectJuzgadoresmuestras($JuzgadoresmuestrasDto);
                            if ($JuzgadoresmuestrasDto != "" && count($JuzgadoresmuestrasDto) > 0) {
                                $JuzgadoresmuestrasDto = $JuzgadoresmuestrasDto[0];
                            } else {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO RELACION ENTRE LA SOLICITUD Y EL JUZGADOR");
                            }
                        }

                        if (!$error) {
                            #CONSULTAMOS LA INFORMACION DEL JUEZ 
                            $JuzgadoresDao = new JuzgadoresDAO();
                            $JuzgadoresDto = new JuzgadoresDTO();
                            $JuzgadoresDto->setIdJuzgador($JuzgadoresmuestrasDto->getIdJuzgador());
                            $JuzgadoresDto = $JuzgadoresDao->selectJuzgadores($JuzgadoresDto);
                            if ($JuzgadoresDto != "" && count($JuzgadoresDto) > 0) {
                                $JuzgadoresDto = $JuzgadoresDto[0];
                            } else {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO INFORMACION DE EL JUEZ");
                            }
                        }

                        if (!$error) {
                            #CONSULTAMOS TIPOS DE JUECES
                            $TiposjuzgadoresDao = new TiposjuzgadoresDAO();
                            $TiposjuzgadoresDto = new TiposjuzgadoresDTO();
                            $TiposjuzgadoresDto->setCveTipoJuzgador($JuzgadoresDto->getCveTipoJuzgador());
                            $TiposjuzgadoresDto = $TiposjuzgadoresDao->selectTiposjuzgadores($TiposjuzgadoresDto);
                            if ($TiposjuzgadoresDto != "" && count($TiposjuzgadoresDto) > 0) {
                                $TiposjuzgadoresDto = $TiposjuzgadoresDto[0];
                            } else {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO INFORMACION DE EL JUEZ");
                            }
                        }

                        if (!$error) {
                            #CONSULTAMOS GENEROS
                            $GenerosDao = new GenerosDAO();
                            $GenerosDto = new GenerosDTO();
                            $GenerosDto = $GenerosDao->selectGeneros($GenerosDto);
                            if ($GenerosDto != "" && count($GenerosDto) > 0) {
                                
                            } else {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO INFORMACION DE GENEROS");
                            }
                        }

                        if (!$error) {
                            $html.="<tr>";
                            $html.="<td colspan='4'>";
                            $html.="<div style='text-align: center; border: 1px ;'><strong>ORDEN DE TOMA DE MUESTRAS ";
                            if ($RespMuestraDto->getCveRespuestaSolicitudMuestra() == "1") {
                                $html.="NEGADA ";
                            }

                            $html.= "</strong></div>";
                            $html.="<table border='0' cellpadding='2' cellspacing='0' style='width: 100%; border: solid 1px black;'>";
                            $html.="<tr>";
                            $html.="<td style='width: 100%; text-align: justify'>El " . $JuzgadoresDto->getTitulo() . " " . $JuzgadoresDto->getNombre() . " " . $JuzgadoresDto->getPaterno() . " " . $JuzgadoresDto->getMaterno() . ", juez de " . $TiposjuzgadoresDto->getDesTipoJuzgador() . " del " . $JuzgadosDto->getDesJuzgado() . ", ";

                            switch ($RespMuestraDto->getCveRespuestaSolicitudMuestra()) {
                                case 1:
                                    $html.="NEG&Oacute; ";
                                    break;
                                case 2:
                                    $html.="AUTORIZ&Oacute; ";
                                    break;
                                case 3:
                                    $html.="AUTORIZ&Oacute; PARCIALMENTE ";
                                    break;
                            }

                            $listaUsuarios = "";
                            try {
                                $UsuarioCliente = new UsuarioCliente();
                                $listaUsuarios = json_decode($UsuarioCliente->selectUsuarios_In($SolicitudesmuestrasDto->getCveUsuario()), true);
                            } catch (Exception $ex) {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "ERROR AL CONSUMIR WEB SERVICE DEL MINISTERIO PUBLICO EN EL SISTEMA DE GESTION");
                            }
                            $nombreMP = "NO ENCONTRADO EN GESTION";
                            if ($listaUsuarios != "") {
                                $nombreMP = $listaUsuarios["data"][0]["nombre"] . " " . $listaUsuarios["data"][0]["paterno"] . " " . $listaUsuarios["data"][0]["materno"];
                                $nombreMP = strtoupper($nombreMP);
                            } else {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO INFORMACION DEL MINISTERIO PUBLICO EN EL SISTEMA DE GESTION");
                            }
                            $html.="la solicitud de Actos de Investigación que requieren autorización judicial (Toma de Muestras) solicitado por el LIC. " . $nombreMP . " Agente del Ministerio P&uacute;blico de la Procuradur&iacute;a General de Justicia del Estado, en los t&eacute;rminos siguientes:</td>";
                            $html.="</tr>";



                            $html.="</table>";
                            $html.="</td>";
                            $html.="</tr>";

                            $html.="<tr>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="</tr>";

                            $html.="<tr>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="<td style='width:25%;'>&nbsp;</td>";
                            $html.="</tr></table>";
                        }

                        if (!$error) {
                            if ($RespMuestraDto->getCveRespuestaSolicitudMuestra() != 1) {
                                if (!$error) {
                                    #CONSULTAMOS INFORMACION DE LOS IMPUTADOS DE LA SCOLICITUD DE LA TOMA DE MUESTRAS
                                    $ImputadosmuestrasDao = new ImputadosmuestrasDAO();
                                    $ImputadosmuestrasDto = new ImputadosmuestrasDTO();
                                    $TomaMuestrasDAO = new TomamuestrasDAO();
                                    $MuestrasDAO = new MuestrasDAO();

                                    $ImputadosmuestrasDto->setIdSolicitudMuestra($SolicitudesmuestrasDto->getIdSolicitudMuestra());
                                    $ImputadosmuestrasDto->setActivo("S");
                                    $ImputadosmuestrasDto->setCveOrigen("S");
                                    $ImputadosmuestrasDto = $ImputadosmuestrasDao->selectImputadosmuestras($ImputadosmuestrasDto);
                                    if ($ImputadosmuestrasDto != "" && count($ImputadosmuestrasDto) > 0) {
                                        $html.="<div style='text-align: center'><strong>IMPUTADO";
                                        if (count($ImputadosmuestrasDto) > 1) {
                                            $html.="S";
                                        }
                                        $html.="</strong></div>";
                                        $countImputados = 1;
                                        foreach ($ImputadosmuestrasDto as $ImputadoMuestra) {
                                            $html.="<p><strong>$countImputados.- Nombre:</strong> ";
                                            if ($ImputadoMuestra->getCveTipoPersona() == "1") {
                                                $html.= $ImputadoMuestra->getNombre() . " " . $ImputadoMuestra->getPaterno() . " " . $ImputadoMuestra->getMaterno();
                                            } else {
                                                $html.=$ImputadoMuestra->getNombreMoral();
                                            }
                                            $html.="</p>";
                                            $html.="<p><strong>Domicilio:</strong> " . $ImputadoMuestra->getDomicilio() . "</p>";

                                            #OBTENEMOS LAS TOMAS DE MUESTRAS
                                            $TomaMuestrasDto = new TomamuestrasDTO();
                                            $TomaMuestrasDto->setIdImputadoMuestra($ImputadoMuestra->getIdImputadoMuestra());
                                            $TomaMuestrasDto = $TomaMuestrasDAO->selectTomamuestras($TomaMuestrasDto);
                                            $muestras = "";
                                            $examenes = "";
                                            if ($TomaMuestrasDto != "") {
                                                foreach ($TomaMuestrasDto as $tomamuestra) {
                                                    $MuestrasDto = new MuestrasDTO();
                                                    $MuestrasDto->setCveMuestra($tomamuestra->getCveMuestra());
                                                    $MuestrasDto->setActivo("S");
                                                    $MuestrasDto = $MuestrasDAO->selectMuestras($MuestrasDto);
                                                    if ($MuestrasDto != "") {
                                                        $MuestrasDto = $MuestrasDto[0];
                                                        if ($MuestrasDto->getTipo() == "M") {
                                                            $muestras .= $MuestrasDto->getDesMuestra() . ", ";
                                                        } else if ($MuestrasDto->getTipo() == "F") {
                                                            $examenes .= $MuestrasDto->getDesMuestra() . ", ";
                                                        }
                                                    }
                                                }
                                            }
                                            if ($muestras != "") {
                                                $muestras = substr($muestras, 0, strlen($muestras) - 2);
                                                $html.="<p style='margin-left: 50px'><strong>TOMA DE MUESTRAS FRACCI&Oacute;N 4: </strong>" . $muestras . "</p>";
                                            }
                                            if ($examenes != "") {
                                                $examenes = substr($examenes, 0, strlen($examenes) - 2);
                                                $html.="<p style='margin-left: 50px'><strong>RECONOCIMIENTO DE EX&Aacute;MENES F&Iacute;SICOS FRACCI&Oacute;N 5: </strong>" . $examenes . "</p>";
                                            }

                                            $countImputados++;
                                        }
                                        $html.="<table cellspacing='1' cellpadding='2' style='width: 100%; text-align: left; font-size: 11pt;' border='0'><tr>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="</tr>";

                                        $html.="<tr>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="</tr></table>";
                                    }
                                }

                                if (!$error) {
                                    #CONSULTAMOS INFORMACION DE LOS OFENDIDOS DE LA SCOLICITUD DE TOMA DE MUESTRAS
                                    $OfendidosmuestrasDao = new OfendidosmuestrasDAO();
                                    $OfendidosmuestrasDto = new OfendidosmuestrasDTO();
                                    $TomaMuestrasDAO = new TomamuestrasDAO();
                                    $MuestrasDAO = new MuestrasDAO();

                                    $OfendidosmuestrasDto->setIdSolicitudMuestra($SolicitudesmuestrasDto->getIdSolicitudMuestra());
                                    $OfendidosmuestrasDto->setActivo("S");
                                    $OfendidosmuestrasDto->setCveOrigen("2");
                                    $OfendidosmuestrasDto = $OfendidosmuestrasDao->selectOfendidosmuestras($OfendidosmuestrasDto);
                                    if ($OfendidosmuestrasDto != "" && count($OfendidosmuestrasDto) > 0) {
                                        $html.="<div style='text-align: center'><strong>VICTIMA";
                                        if (count($OfendidosmuestrasDto) > 1) {
                                            $html.="S";
                                        }
                                        $html.="</strong></div>";
                                        $countOfendidos = 1;
                                        foreach ($OfendidosmuestrasDto as $OfendidoMuestra) {
                                            $html.="<p><strong>$countOfendidos.- Nombre: </strong>";
                                            $tutoresString = "";
                                            if ($OfendidoMuestra->getCveTipoPersona() == "1" || $OfendidoMuestra->getCveTipoPersona() == "4" || $OfendidoMuestra->getCveTipoPersona() == "5") {
                                                $html.= $OfendidoMuestra->getNombre() . " " . $OfendidoMuestra->getPaterno() . " " . $OfendidoMuestra->getMaterno();
                                                if ($OfendidoMuestra->getCveTipoPersona() == "4" || $OfendidoMuestra->getCveTipoPersona() == "5") {
                                                    // Obtenemos la Informacion deL Tutor del Infante
                                                    $tutorDto = new TutoresofendidosmuestrasDTO();
                                                    $tutorDto->setIdOfendidoMuestra($OfendidoMuestra->getIdOfendidoMuestra());
                                                    $tutorDao = new TutoresofendidosmuestrasDAO();
                                                    $tutorDto = $tutorDao->selectTutoresofendidosmuestras($tutorDto);
                                                    if ($tutorDto != "" && count($tutorDto) > 0) {
                                                        $tutorDto = $tutorDto[0];
                                                        $nombreTutor = strtoupper(utf8_encode($tutorDto->getNombre() . " " . $tutorDto->getPaterno() . " " . $tutorDto->getMaterno()));
                                                        $tutoresString.="<p style='margin-left: 50px'><strong>Nombre del Tutor: </strong>" . $nombreTutor . "</p>";
                                                        $tutoresString.="<p style='margin-left: 50px'><strong>Domicilio del Tutor: </strong>" . strtoupper($tutorDto->getDomicilio()) . "</p>";
                                                    } else {
                                                        $tutoresString.="<p  style='margin-left: 10px'><strong>No tiene tutor asignado. </strong></p>";
                                                    }
                                                }
                                            } else {
                                                $html.=$OfendidoMuestra->getNombreMoral();
                                            }
                                            $html.="</p>";
                                            $html.="<p><strong>Domicilio: </strong>" . $OfendidoMuestra->getDomicilio() . "</p>";

                                            #OBTENEMOS LAS TOMAS DE MUESTRAS
                                            $TomaMuestrasDto = new TomamuestrasDTO();
                                            $TomaMuestrasDto->setIdOfendidoMuestra($OfendidoMuestra->getIdOfendidoMuestra());
                                            $TomaMuestrasDto = $TomaMuestrasDAO->selectTomamuestras($TomaMuestrasDto);
                                            $muestras = "";
                                            $examenes = "";
                                            if ($TomaMuestrasDto != "") {
                                                foreach ($TomaMuestrasDto as $tomamuestra) {
                                                    $MuestrasDto = new MuestrasDTO();
                                                    $MuestrasDto->setCveMuestra($tomamuestra->getCveMuestra());
                                                    $MuestrasDto->setActivo("S");
                                                    $MuestrasDto = $MuestrasDAO->selectMuestras($MuestrasDto);
                                                    if ($MuestrasDto != "") {
                                                        $MuestrasDto = $MuestrasDto[0];
                                                        if ($MuestrasDto->getTipo() == "M") {
                                                            $muestras .= $MuestrasDto->getDesMuestra() . ", ";
                                                        } else if ($MuestrasDto->getTipo() == "F") {
                                                            $examenes .= $MuestrasDto->getDesMuestra() . ", ";
                                                        }
                                                    }
                                                }
                                            }
                                            if ($muestras != "") {
                                                $muestras = substr($muestras, 0, strlen($muestras) - 2);
                                                $html.="<p style='margin-left: 50px'><strong>TOMA DE MUESTRAS FRACCI&Oacute;N 4: </strong>" . $muestras . "</p>";
                                            }
                                            if ($examenes != "") {
                                                $examenes = substr($examenes, 0, strlen($examenes) - 2);
                                                $html.="<p style='margin-left: 50px'><strong>RECONOCIMIENTO DE EX&Aacute;MENES F&Iacute;SICOS FRACCI&Oacute;N 5: </strong>" . $examenes . "</p>";
                                            }

                                            $html .= $tutoresString;
                                            $countOfendidos++;
                                        }
                                        $html.="<table cellspacing='1' cellpadding='2' style='width: 100%; text-align: left; font-size: 11pt;' border='0'><tr>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="</tr>";

                                        $html.="<tr>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="<td style='width:25%;'>&nbsp;</td>";
                                        $html.="</tr></table>";
                                    }
                                }

                                #OBTENEMOS DATOS DE LA PRACTICA
                                if ($RespMuestraDto->getFechaPractica() != "" || $RespMuestraDto->getHorasPractica() != "") {
                                    $html.="<table cellspacing='1' cellpadding='2' style='width: 100%; text-align: left; font-size: 11pt;' border='0'><tr>";
                                    $html.="<td colspan='4'>";
                                    $html.="<div style='text-align: center; border: 1px ;'><strong>PR&Aacute;CTICA</strong></div>";
                                    $html.="<table border='0' cellpadding='2' cellspacing='0' style='width: 100%; border: solid 1px black;'>";
                                    if ($RespMuestraDto->getFechaPractica() != "" && ($RespMuestraDto->getHorasPractica() == "" || $RespMuestraDto->getHorasInforme() == "0")) {
                                        $html.="<tr>";
                                        $html.="<td style='width: 50%; text-align: center'><b>Fecha</b></td>";
                                        $html.="<td style='width: 50%; text-align: center'><b>Hora</b></td>";
                                        $html.="</tr>";
                                        $html.="<tr>";
                                        $html.="<td style='width: 50%; text-align: center'><b>" . $this->cambiaf_a_normal($RespMuestraDto->getFechaPractica()) . "</b></td>";
                                        $html.="<td style='width: 50%; text-align: center'><b>" . $RespMuestraDto->getHoraPractica() . "</b></td>";
                                        $html.="</tr>";
                                    } else {
                                        $html.="<tr>";
                                        $html.="<td style='width: 50%; text-align: right'><b>Plazo m&aacute;ximo en horas: </b></td>";
                                        $html.="<td style='width: 50%; text-align: left'><b>" . $RespMuestraDto->getHorasPractica() . "</b></td>";
                                        $html.="</tr>";
                                    }

                                    $html.="</table>";
                                    $html.="</td>";
                                    $html.="</tr>";

                                    $html.="<tr>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="</tr>";

                                    $html.="<tr>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="</tr>";
                                }

                                #OBTENEMOS DATOS DE EL INFORME
                                if ($RespMuestraDto->getFechaInforme() != "" || $RespMuestraDto->getHorasInforme() != "") {
                                    $html.="<tr>";
                                    $html.="<td colspan='4'>";
                                    $html.="<div style='text-align: center; border: 1px ;' ><strong>INFORME</strong></div>";
                                    $html.="<table border='0' cellpadding='2' cellspacing='0' style='width: 100%; border: solid 1px black;'>";
                                    $html.="<tr>";
                                    $html.="<td colspan='2' style='width: 100%; text-align: left'>Se deber&aacute; emitir un informe sobre la ejecuci&oacute;n que se brinda a esta orden de toma de muestras, preferentemente, por el Agente del Ministerio P&uacute;blico solicitante.</td>";
                                    $html.="</tr>";
                                    if ($RespMuestraDto->getFechaInforme() != "" && ($RespMuestraDto->getHorasInforme() == "" || $RespMuestraDto->getHorasInforme() == "0")) {
                                        $html.="<tr>";
                                        $html.="<td style='width: 50%; text-align: center'>Fecha</td>";
                                        $html.="<td style='width: 50%; text-align: center'>Hora</td>";
                                        $html.="</tr>";
                                        $html.="<tr>";
                                        $html.="<td style='width: 50%; text-align: center'><b>" . $this->cambiaf_a_normal($RespMuestraDto->getFechaInforme()) . "</b></td>";
                                        $html.="<td style='width: 50%; text-align: center'><b>" . $RespMuestraDto->getHoraInforme() . "</b></td>";
                                        $html.="</tr>";
                                    } else {
                                        $html.="<tr>";
                                        $html.="<td style='width: 50%; text-align: right'><b>Plazo m&aacute;ximo en horas:</b></td>";
                                        $html.="<td style='width: 50%; text-align: left'><b>" . $RespMuestraDto->getHorasInforme() . "</b></td>";
                                        $html.="</tr>";
                                    }
//
                                    $html.="</table>";
                                    $html.="</td>";
                                    $html.="</tr>";

                                    $html.="<tr>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="</tr>";

                                    $html.="<tr>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="</tr>";
                                }
                            }
                        }

                        if (!$error) {
                            #CATEO NEGADO
                            if ($RespMuestraDto->getCveRespuestaSolicitudMuestra() == "1" || $RespMuestraDto->getCveRespuestaSolicitudMuestra() == "3") {
                                $html.="<tr>";
                                $html.="<td colspan='4'>";
                                $html.="<div style='text-align: center; border: 1px ;'><strong>AUTORIZACI&Oacute;N NEGADA</strong></div>";
                                $html.="</td>";
                                $html.="</tr></table>";
                                $negada = preg_replace("/\n/", "<br>", $RespMuestraDto->getNegada());
                                $negada = strip_tags($negada, "<p>");
                                $negada = preg_replace("/\'/", "\"", $negada);
                                $total = strlen(trim($negada));
                                if ($total >= 1) {
                                    //$paginas = ceil($total / 2258);
                                    //for ($index = 0; $index < $paginas; $index++) {
                                    //$text = Trim(substr($negada, ($index * (2258)), (2258)));
                                    //$html.="<tr>\n";
                                    //$html.="<td colspan='4' style='width:100%; text-align: justify;font-size: 10pt'>\n
                                    //<p>" . $text . "</p>\n
                                    //</td>\n";
                                    //$html.="</tr>\n";
                                    //}
                                    $html .= "<p>$negada</p>";
                                }
                                $html.="<table style='width: 100%; border: solid 0px black;' ><tr>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="</tr>";

                                $html.="<tr>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="</tr>";
                            }
                        }

                        if (!$error) {
                            #LEYENDA  DE LA RESPUESTA DEL JUEZ
                            if ($RespMuestraDto->getCveRespuestaSolicitudMuestra() != "") {
                                $html.="<tr>";
                                $html.="<td colspan='4'>";
                                $html.="<table border='0' cellpadding='2' cellspacing='0' style='width: 100%; border: solid 1px black;'>";
                                $html.="<tr>";
                                if ($RespMuestraDto->getCveRespuestaSolicitudMuestra() == 3) {
                                    $html.="<td  style='width: 100%; text-align: justify'>La presente orden de toma de muestras y su negativa parcial, se sustenta en la resoluci&oacute;n siguiente: </td>";
                                }
                                if ($RespMuestraDto->getCveRespuestaSolicitudMuestra() == 2) {
                                    $html.="<td style='width: 100%; text-align: justify'>La presente orden de toma de muestras se sustenta en la resoluci&oacute;n siguiente:</td>";
                                }
                                if ($RespMuestraDto->getCveRespuestaSolicitudMuestra() == 1) {
                                    $html.="<td style='width: 100%; text-align: justify'>La negativa de orden de toma de muestras se sustenta en la resoluci&oacute;n siguiente:</td>";
                                }

                                $html.="</tr>";
                                $html.="</table>";
                                $html.="</td>";
                                $html.="</tr>";

                                $html.="<tr>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="</tr>";

                                $html.="<tr>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="</tr>";
                            } else {
                                $error = true;
                                $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO LA CLAVE DE LA RESPUESTA DEL JUEZ");
                            }
                        }

                        if (!$error) {
                            #RESOLUCION DE LA RESPUESTA DEL CATEO
                            if ($RespMuestraDto->getConcedida() != "") {
                                $html.="<tr>";
                                $html.="<td colspan='4'>";
                                $html.="<div style='text-align: center; border: 1px ;'><strong>RESOLUCI&Oacute;N</strong></div>";
                                $html.="</td>";
                                $html.="</tr></table>";
                                $concedida = preg_replace("/\n/", "<br>", $RespMuestraDto->getConcedida());
                                $concedida = strip_tags($concedida, "<p>");
                                $concedida = preg_replace("/\'/", "\"", $concedida);
                                $total = strlen(trim($concedida));
                                if ($total >= 1) {
                                    $html .= "<p>$concedida</p>";
                                }
                                $html.="<table style='width: 100%; border: solid 0px black;' ><tr>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="</tr>";

                                $html.="<tr>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="<td style='width:25%;'>&nbsp;</td>";
                                $html.="</tr>";
                            }
                        }

                        if (!$error) {
                            #LISTA DE MINISTERIOS PUBLICOS RESPONSABLES
                            if ($RespMuestraDto->getCveRespuestaSolicitudMuestra() != "1") {
                                $MinisteriosresponsablesDao = new MinisteriosresponsablesmuestrasDAO();
                                $MinisteriosresponsablesDto = new MinisteriosresponsablesmuestrasDTO();
                                $MinisteriosresponsablesDto->setIdSolicitudMuestra($SolicitudesmuestrasDto->getIdSolicitudMuestra());
                                $MinisteriosresponsablesDto = $MinisteriosresponsablesDao->selectMinisteriosresponsablesmuestras($MinisteriosresponsablesDto);
                                if ($MinisteriosresponsablesDto != "" && count($MinisteriosresponsablesDto) > 0) {
                                    $html.="<tr>";
                                    $html.="<td colspan='4'>";
                                    $html.="<div style='text-align: center'><strong>M.P. RESPONSABLE";
                                    if (count($MinisteriosresponsablesDto) > 1) {
                                        $html.="S";
                                    }
                                    $html.=":</strong></div>";
                                    $html.="<table border='1' cellpadding='2' cellspacing='0' style='width: 100%; border: solid 1px black;'>";
                                    $html.="<tr>";
                                    $html.="<td style='width: 100%; text-align: center'>Nombre</td>";
                                    $html.="</tr>";
                                    foreach ($MinisteriosresponsablesDto as $MinisterioResponsable) {
                                        $html.="<tr>";
                                        $html.="<td style='width: 100%; text-align: left'>" . $MinisterioResponsable->getNombre() . " " . $MinisterioResponsable->getPaterno() . " " . $MinisterioResponsable->getMaterno() . "</td>";
                                        $html.="</tr>";
                                    }
                                    $html.="</table>";
                                    $html.="</td>";
                                    $html.="</tr>";

                                    $html.="<tr>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="</tr>";

                                    $html.="<tr>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="<td style='width:25%;'>&nbsp;</td>";
                                    $html.="</tr>";
                                }
                            }
                        }

                        if (!$error) {
                            #DATOS DE EL JUEZ AL FINAL DEL DOCUMENTO
                            $html.="<tr>";
                            $html.="<td text-align: right;font-size: 10pt' colspan='3'>As&iacute; lo resolvi&oacute; el: </td>";
                            $html.="</tr>";
                            $html.="<tr>";
                            $html.="<td text-align: left;font-size: 10pt' colspan='4'>" . $JuzgadoresDto->getTitulo() . " " . $JuzgadoresDto->getNombre() . " " . $JuzgadoresDto->getMaterno() . " " . $JuzgadoresDto->getPaterno() . ", JUEZ DE " . $TiposjuzgadoresDto->getDesTipoJuzgador() . " del " . $JuzgadosDto->getDesJuzgado() . "</td>";
                            $html.="</tr>";

                            $html.="<tr>";
                            $html.="<td>&nbsp;</td>";
                            $html.="</tr>";

                            $html.="<tr>";
                            $html.="<td>&nbsp;</td>";
                            $html.="</tr>";
                        }

                        if (!$error) {
                            #QR Y SELLO DIGITAL
                            $html.="<tr>";
                            $html.="<td style='width:25%; text-align: center' rowspan='1'><qrcode value='" . $RespMuestraDto->getQr() . "' ec='L' style='width: 30mm; border: 0px solid #000000;'></qrcode></td>"; //$html.="<img src='generaCodigo.php?referencia=000001/13' width='100%' height='50px'>";
                            $html.="<td style='width:75%; text-align: center' colspan='3'>";
                            $html.="<table border='0' >";

                            $html.="<tr>";
                            $html.="<td style='text-align: left;'>Firma Electrónica:</td>";
                            $html.="</tr>";

                            $totalCadena = strlen(trim($RespMuestraDto->getSelloDigital()));
                            $pag = ceil($totalCadena / 70);

                            for ($index = 0; $index < $pag; $index++) {
                                $html.="<tr>";
                                $html.="<td style='text-align: left;    width: 20%;font-size: 8pt'>" . Trim(substr($RespMuestraDto->getSelloDigital(), ($index * 70), 70)) . "</td>";
                                $html.="</tr>";
                            }

                            $converter = new Encryption;
                            $converter->setPrivateKey($RespMuestraDao->extraeLlavePrivada("selloDigital/keystoreTSJEDOMEX.key.pem"));
                            $strCadenaOrig = $converter->decode($RespMuestraDto->getSelloDigital());
                            $strCadenaOrigAux = "||";
                            $arrayCadenaOrig = explode("|", $strCadenaOrig);


                            for ($index = 0; $index < count($arrayCadenaOrig); $index++) {
                                if ($index > 2 && $index < (count($arrayCadenaOrig) - 3)) {
                                    $strCadenaOrigAux .= $arrayCadenaOrig[$index] . "|";
                                }
                            }
                            $strCadenaOrigAux .= "|";

                            $totalCadena = strlen(trim($strCadenaOrigAux));
                            $pag = ceil($totalCadena / 70);
                            $html.="<tr>";
                            $html.="<td>&nbsp;</td>";
                            $html.="</tr>";


                            $html.="<tr>";
                            $html.="<td style='text-align: left;'>Cadena Original:</td>";
                            $html.="</tr>";
                            for ($index = 0; $index < $pag; $index++) {

                                $html.="<tr>";
                                $html.="<td style='text-align: left; width: 20%;font-size: 8pt'  >" . Trim(substr($strCadenaOrigAux, ($index * 70), 70)) . "</td>";
                                $html.="</tr>";
                            }

                            $html.="</table>";
                            $html.="</td>";
                            $html.="</tr>";


                            $html.="</table>";
                            $html.="</page>";
                        }

                        if (!$error && $html != "") {
                            #GENERAMOS EL ARCHIVO PDF EN BASE AL CODIGO HTML ANTERIOR
                            date_default_timezone_set("America/Mexico_City");
                            ob_start();
                            echo utf8_encode($html);
                            $content = ob_get_clean();
                            $name = "Respuesta_" . $RespMuestraDto->getQr() . ".pdf";
                            $ruta = "/solicitudespdf/" . $name;
                            $generaPDF = false;

                            try {
                                // init HTML2PDF
                                $html2pdf = new HTML2PDF('P', 'A4', 'es', true, 'UTF-8', array(0, 0, 0, 0));
                                $html2pdf->pdf->SetAuthor("PODER JUDICIAL DEL ESTADO DE MEXICO");
                                $html2pdf->writeHTML($content);
                                $html2pdf->Output("./../../../solicitudespdf/" . $name, 'F');
                                $generaPDF = true;
                            } catch (HTML2PDF_exception $e) {
                                $generaPDF = false;
                            }

                            if ($generaPDF) {
                                $tmp = array("type" => "OK",
                                    "text" => "SE GENERO EL PDF DE LA RESPUESTA DE LA TOMA DE MUESTRAS CORRECTAMENTE",
                                    "fileName" => "Respuesta_" . str_pad($RespMuestraDto->getNumeroMuestra(), 6, '0', STR_PAD_LEFT) . "/" . $RespMuestraDto->getAnioMuestra() . '.pdf',
                                    "file" => "Respuesta_" . $RespMuestraDto->getQr() . ".pdf");
                            } else {
                                $tmp = array("type" => "Error",
                                    "text" => "ERROR AL GENERAL EL PDF DE LA  SOLICITUD. DETALLE DEL ERROR:" . $e,
                                    "file" => "");
                            }
                        }
                    }
                } else {
                    $error = true;
                    $tmp = array("type" => "Error", "text" => "NO SE ENCONTRO INFORMACION DE LA SOLICITUD DE TOMA DE MUESTRAS");
                }
            }
        } else {
            $tmp = array("type" => "Error", "text" => "IDENTIFICADOR DE SOLICITUD DE TOMA DE MUESTRAS NO VALIDO");
        }
        return $tmp;
    }

    public function cambiaf_a_normal($fecha) {
        @list( $anio, $mes, $dia) = explode("-", $fecha);
        return $dia . "/" . $mes . "/" . $anio;
    }

    public function FechaLarga($fecha) {
        $anio = substr($fecha, 0, 4);
        if (substr($fecha, 5, 2) == "01") {
            $mes = "Enero";
        }
        if (substr($fecha, 5, 2) == "02") {
            $mes = "Febrero";
        }
        if (substr($fecha, 5, 2) == "03") {
            $mes = "Marzo";
        }
        if (substr($fecha, 5, 2) == "04") {
            $mes = "Abril";
        }
        if (substr($fecha, 5, 2) == "05") {
            $mes = "Mayo";
        }
        if (substr($fecha, 5, 2) == "06") {
            $mes = "Junio";
        }
        if (substr($fecha, 5, 2) == "07") {
            $mes = "Julio";
        }
        if (substr($fecha, 5, 2) == "08") {
            $mes = "Agosto";
        }
        if (substr($fecha, 5, 2) == "09") {
            $mes = "Septiembre";
        }
        if (substr($fecha, 5, 2) == "10") {
            $mes = "Octubre";
        }
        if (substr($fecha, 5, 2) == "11") {
            $mes = "Noviembre";
        }
        if (substr($fecha, 5, 2) == "12") {
            $mes = "Diciembre";
        }
        $dia = substr($fecha, 8, 2);
        $hora = substr($fecha, 11, 5);

        return $dia . " de " . $mes . " de " . $anio . " a las: " . $hora . " hrs.";
    }

}

?>
