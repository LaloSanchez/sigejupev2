<?php

//solicitud de audiencia
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/solicitudesaudiencias/SolicitudesaudienciasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/solicitudesaudiencias/SolicitudesaudienciasDAO.Class.php");
//cataudiencias
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/cataudiencias/CataudienciasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/cataudiencias/CataudienciasDAO.Class.php");
//naturalezas
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/naturalezas/NaturalezasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/naturalezas/NaturalezasDAO.Class.php");
//Estatus audiencias
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/estatusaudiencias/EstatusaudienciasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/estatusaudiencias/EstatusaudienciasDAO.Class.php");
//Estatus solicitudes
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/estatussolicitudes/EstatussolicitudesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/estatussolicitudes/EstatussolicitudesDAO.Class.php");
//Tipo de audiencia
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/tiposaudiencias/TiposaudienciasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/tiposaudiencias/TiposaudienciasDAO.Class.php");
//Etapa procesal
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/etapasprocesales/EtapasprocesalesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/etapasprocesales/EtapasprocesalesDAO.Class.php");
//juzgados
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/juzgados/JuzgadosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/juzgados/JuzgadosDAO.Class.php");
//tipos carpetas
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/tiposcarpetas/TiposcarpetasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/tiposcarpetas/TiposcarpetasDAO.Class.php");
//imputados
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/imputadossolicitudes/ImputadossolicitudesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/imputadossolicitudes/ImputadossolicitudesDAO.Class.php");
//domicilios imputados
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/domiciliosimputadossolicitudes/DomiciliosimputadossolicitudesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/domiciliosimputadossolicitudes/DomiciliosimputadossolicitudesDAO.Class.php");
//ofendidos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/ofendidossolicitudes/OfendidossolicitudesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/ofendidossolicitudes/OfendidossolicitudesDAO.Class.php");
//domicilios ofendidos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/domiciliosofendidossolicitudes/DomiciliosofendidossolicitudesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/domiciliosofendidossolicitudes/DomiciliosofendidossolicitudesDAO.Class.php");
//delitossolicitudes
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/delitossolicitudes/DelitossolicitudesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/delitossolicitudes/DelitossolicitudesDAO.Class.php");
//delitos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/delitos/DelitosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/delitos/DelitosDAO.Class.php");

//impofedel
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/impofedelsolicitudes/ImpofedelsolicitudesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/impofedelsolicitudes/ImpofedelsolicitudesDAO.Class.php");

//efectos ofendidos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/efectosofendidos/EfectosofendidosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/efectosofendidos/EfectosofendidosDAO.Class.php");
//violencia de genero
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/violenciadegenero/ViolenciadegeneroDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/violenciadegenero/ViolenciadegeneroDAO.Class.php");
//efectos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/efectos/EfectosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/efectos/EfectosDAO.Class.php");
//detalles efectos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/detallesefectos/DetallesefectosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/detallesefectos/DetallesefectosDAO.Class.php");
//resumensolicitudDao
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/resumensolicitudaudiencia/ResumensolicitudaudienciaDao.Class.php");

//factores sociales
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/violenciafactoressociales/ViolenciafactoressocialesDTO.Class.php");

//factores culturales
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/factoresculturales/FactoresculturalesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/factoresculturales/FactoresculturalesDAO.Class.php");
//violenciacontroller
include_once(dirname(__FILE__) . "/../../../controladores/sigejupe/violencia/ViolenciaController.Class.php");

//violencia homcidios dolosos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/violenciahomicidiosdolosos/ViolenciahomicidiosdolososDTO.Class.php");
//homicidios dolosos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/homicidiosdolosos/HomicidiosdolososDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/homicidiosdolosos/HomicidiosdolososDAO.Class.php");

//sexuales
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/sexuales/SexualesDTO.Class.php");

//modalidades
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/modalidadesacosos/ModalidadesacososDAO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/modalidadesacosos/ModalidadesacososDTO.Class.php");
//ambitos
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/ambitosacosos/AmbitosacososDAO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/ambitosacosos/AmbitosacososDTO.Class.php");
//sexuales conductas dto
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/sexualesconductas/SexualesconductasDTO.Class.php");
//detalles sexuales conductas
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/detallessexualesconductas/DetallessexualesconductasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/detallessexualesconductas/DetallessexualesconductasDAO.Class.php");
//conductas
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/conductas/ConductasDAO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/conductas/ConductasDTO.Class.php");
//testigos sexuales
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/testigossexuales/TestigossexualesDTO.Class.php");
///////
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/salas/SalasDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/salas/SalasDAO.Class.php");

include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/tipospartes/TipospartesDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/tipospartes/TipospartesDAO.Class.php");
///////////////////////////////////////////////////////////////////////////////
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/ceresos/CeresosDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/ceresos/CeresosDAO.Class.php");
/*
 * controlador de solicitud de audiencia para enviar la solicitud
 */
include_once(dirname(__FILE__) . "/../../../controladores/sigejupe/solicitudesaudiencias/SolicitudesaudienciasController.Class.php");
//webService
include_once(dirname(__FILE__) . "/../../../webservice/cliente/usuarios/UsuarioCliente.php");


include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/bitacoraws/BitacorawsDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/bitacoraws/BitacorawsDAO.Class.php");


include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/distritos/DistritosDAO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/distritos/DistritosDAO.Class.php");

//audiencias juzgadores
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/audienciasjuzgador/AudienciasjuzgadorDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/audienciasjuzgador/AudienciasjuzgadorDAO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/juzgadores/JuzgadoresDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/juzgadores/JuzgadoresDAO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dto/funcionesjuzgadores/FuncionesjuzgadoresDTO.Class.php");
include_once(dirname(__FILE__) . "/../../../modelos/sigejupe/dao/funcionesjuzgadores/FuncionesjuzgadoresDAO.Class.php");
date_default_timezone_set('America/Mexico_City');

class ResumensolicitudaudienciaController {

    public function getSolicitudAudienciaById($idSolicitudAudiencia) {
        $solicitudAudienciaDao = new SolicitudesaudienciasDAO();
        $solicitudAudienciaDto = new SolicitudesaudienciasDTO();
        $solicitudAudienciaDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
        $solicitudAudienciaDto->setActivo('S');

        return $solicitudAudienciaDao->selectSolicitudesaudiencias($solicitudAudienciaDto);
    }

    public function getDesCatAudiencia($cveCatAudiencia) {
        $catAudienciaDao = new CataudienciasDAO();
        $catAudienciaDto = new CataudienciasDTO();
        $catAudienciaDto->setCveCatAudiencia($cveCatAudiencia);

        return $catAudienciaDao->selectCataudiencias($catAudienciaDto);
    }

    public function getDesJuzgado($cveJuzgado) {
        $juzgadoDao = new JuzgadosDAO();
        $juzgadoDto = new JuzgadosDTO();
        $juzgadoDto->setCveJuzgado($cveJuzgado);

        return $juzgadoDao->selectJuzgados($juzgadoDto);
    }

    public function getDesTipoCarpeta($cveTipoCarpeta) {
        $tipoCarpetaDao = new TiposcarpetasDAO();
        $tipoCarpetaDto = new TiposcarpetasDTO();
        $tipoCarpetaDto->setCveTipoCarpeta($cveTipoCarpeta);

        return $tipoCarpetaDao->selectTiposcarpetas($tipoCarpetaDto);
    }

    public function getDesDelito($cveDelito) {
        $delitoDao = new DelitosDAO();
        $delitoDto = new DelitosDTO();
        $delitoDto->setCveDelito($cveDelito);

        return $delitoDao->selectDelitos($delitoDto);
    }

    public function getImputadosByIdSolicitudAudiencia($idSolicitudAudiencia) {
        $impudadoSolicitudDao = new ImputadossolicitudesDAO();
        $imputadosSolicitudDto = new ImputadossolicitudesDTO();
        $imputadosSolicitudDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
        $imputadosSolicitudDto->setActivo('S');

        return $impudadoSolicitudDao->selectImputadossolicitudes($imputadosSolicitudDto);
    }

    public function getDomiciliosImputados($idImputadoSolicitud) {
        $domiciliosImputadosDao = new DomiciliosimputadossolicitudesDAO();
        $domiciliosImputadosDto = new DomiciliosimputadossolicitudesDTO();
        $domiciliosImputadosDto->setIdImputadoSolicitud($idImputadoSolicitud);
        $domiciliosImputadosDto->setActivo('S');
        $domicilios = $domiciliosImputadosDao->selectDomiciliosimputadossolicitudes($domiciliosImputadosDto);
        $array_domicilios = [];

        if ($domicilios != "") {

            foreach ($domicilios as $index => $domicilio) {
                $direccion = ($domicilio->getDireccion() == '') ? '' : $domicilio->getDireccion() . ', ';
                $colonia = ($domicilio->getColonia() == '') ? '' : $domicilio->getColonia() . ', ';
                $cp = ($domicilio->getCp() == '') ? '' : 'C.P: ' . $domicilio->getCp() . '.';

                $domicilio_completo = ($direccion == '' && $colonia == '' && $cp == '') ? 'N/A' : $direccion . $colonia . $cp;

                $array_domicilios[] = utf8_encode($domicilio_completo);
            }
        }


        return $array_domicilios;
    }

    public function getTrataPersonas($idImpOfeDelSolicitud) {
        $resumenDao = new ResumensolicitudaudienciaDao();
        $response = $resumenDao->selectTrataPersonas($idImpOfeDelSolicitud);

        foreach ($response as $index => $trata) {
            $response[$index]['estadoOrigen'] = utf8_encode($trata['estadoOrigen']);
            $response[$index]['municipioOrigen'] = utf8_encode($trata['municipioOrigen']);
            $response[$index]['paisDestino'] = utf8_encode($trata['paisDestino']);
            $response[$index]['estadoDestino'] = utf8_encode($trata['estadoDestino']);
            $response[$index]['municipioDestino'] = utf8_encode($trata['municipioDestino']);
        }

        return $response;
    }

    public function getOfendidosByIdSolicitudAudiencia($idSolicitudAudiencia) {
        $ofendidoSolicitudDao = new OfendidossolicitudesDAO();
        $ofendidoSolicitudDto = new OfendidossolicitudesDTO();
        $ofendidoSolicitudDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
        $ofendidoSolicitudDto->setActivo('S');

        return $ofendidoSolicitudDao->selectOfendidossolicitudes($ofendidoSolicitudDto);
    }

    public function getDomiciliosOfendidos($idOfendidoSolicitud) {
        $domiciliosOfendidosDao = new DomiciliosofendidossolicitudesDAO();
        $domiciliosOfendidosDto = new DomiciliosofendidossolicitudesDTO();
        $domiciliosOfendidosDto->setIdOfendidoSolicitud($idOfendidoSolicitud);
        $domiciliosOfendidosDto->setActivo('S');
        $domicilios = $domiciliosOfendidosDao->selectDomiciliosofendidossolicitudes($domiciliosOfendidosDto);
        $array_domicilios = [];

        if (count($domicilios)) {

            foreach ($domicilios as $index => $domicilio) {

                $direccion = ($domicilio->getDireccion() == '') ? '' : $domicilio->getDireccion() . ', ';
                $colonia = ($domicilio->getColonia() == '') ? '' : $domicilio->getColonia() . ', ';
                $cp = ($domicilio->getCp() == '') ? '' : 'C.P: ' . $domicilio->getCp() . '.';

                $domicilio_completo = ($direccion == '' && $colonia == '' && $cp == '') ? 'N/A' : $direccion . $colonia . $cp;

                $array_domicilios[] = $domicilio_completo;
                //$array_domicilios[] = utf8_encode($direccion . $colonia . $cp);
                //$array_domicilios[] = $domicilio->getDireccion() . ' ,' . $domicilio->getColonia() . ', C.P: ' . $domicilio->getCp();
            }
        }


        return $array_domicilios;
    }

    public function getDelitosByIdSolicitud($idSolicitudAudiencia) {
        $delitosSolicitudDao = new DelitossolicitudesDAO();
        $delitosSolicitudDto = new DelitossolicitudesDTO();
        $delitosSolicitudDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
        $delitosSolicitudDto->setActivo('S');

        return $delitosSolicitudDao->selectDelitossolicitudes($delitosSolicitudDto);
    }

    public function getRelacion($idSolicitudAudiencia) {
        $relacionDao = new ImpofedelsolicitudesDAO();
        $relacionDto = new ImpofedelsolicitudesDTO();
        $relacionDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
        $relacionDto->setActivo('S');

        return $relacionDao->selectImpofedelsolicitudes($relacionDto);
    }

    public function getNameImputadoById($idImputadoSolicitud) {
        $imputadoDao = new ImputadossolicitudesDAO();
        $imputadoDto = new ImputadossolicitudesDTO();
        $imputadoDto->setIdImputadoSolicitud($idImputadoSolicitud);

        $imputado = $imputadoDao->selectImputadossolicitudes($imputadoDto);

        $nombre = "";

        if ($imputado != "") {
            $imputado = $imputado[0];
            $nombre = utf8_encode(($imputado->getCveTipoPersona() == 1) ? $imputado->getNombre() . ' ' . $imputado->getPaterno() . ' ' . $imputado->getMaterno() : $imputado->getNombreMoral());
        }

        return $nombre;
    }

    public function getNameOfendidoById($idOfendidoSolicitud) {
        $ofendidoDao = new OfendidossolicitudesDAO();
        $ofendidoDto = new OfendidossolicitudesDTO();
        $ofendidoDto->setIdOfendidoSolicitud($idOfendidoSolicitud);

        $ofendido = $ofendidoDao->selectOfendidossolicitudes($ofendidoDto);

        $nombre = "";

        if ($ofendido != "") {
            $ofendido = $ofendido[0];
            $nombre = utf8_encode(($ofendido->getCveTipoPersona() == 1) ? $ofendido->getNombre() . ' ' . $ofendido->getPaterno() . ' ' . $ofendido->getMaterno() : $ofendido->getNombreMoral());
        }

        return $nombre;
    }

    public function getDesDelitoById($idDelitoSolicitud) {

        $delitoSolicitudDao = new DelitossolicitudesDAO();
        $delitoSolicitudDto = new DelitossolicitudesDTO();
        $delitoSolicitudDto->setIdDelitoSolicitud($idDelitoSolicitud);

        $delitoSolicitud = $delitoSolicitudDao->selectDelitossolicitudes($delitoSolicitudDto);

        $desDelito = '';

        if ($delitoSolicitud != '') {
            $delito = $this->getDesDelito($delitoSolicitud[0]->getCveDelito());
            $desDelito = $delito[0]->getDesDelito();
        }

        return $desDelito;
    }

    public function getViolenciaGenero($idImpOfeSolicitud) {
        $ViolenciadegeneroDto = new ViolenciadegeneroDTO();
        $ViolenciadegeneroDto->setIdImpOfeDelSolicitud($idImpOfeSolicitud);
        $ViolenciadegeneroDto->setActivo('S');

        $EfectosofendidosDto = new EfectosofendidosDTO();
        $EfectosofendidosDto->setIdImpOfeDelSolicitud($idImpOfeSolicitud);
        $EfectosofendidosDto->setActivo('S');

        $ViolenciadegeneroDao = new ViolenciadegeneroDAO();
        $EfectosofendidosDao = new EfectosofendidosDAO();

        $ViolenciadegeneroDto = $ViolenciadegeneroDao->selectViolenciadegenero($ViolenciadegeneroDto);

        $response = [];

        if ($ViolenciadegeneroDto != "") {


            $efectosDao = new EfectosDAO();
            $efectosDto = new EfectosDTO();
            $detallesEfectosDao = new DetallesefectosDAO();
            $detallesEfectosDto = new DetallesefectosDTO();

            foreach ($ViolenciadegeneroDto as $index => $violenciadegenero) {

                $efectosDto->setCveEfecto($violenciadegenero->getCveEfecto());
                $efectosDto->setActivo('S');
                $rsEfectos = $efectosDao->selectEfectos($efectosDto);

                $response[$index]['idViolenciaDeGenero'] = utf8_encode($violenciadegenero->getIdViolenciaDeGenero());
                $response[$index]['cveEfecto'] = utf8_encode($violenciadegenero->getCveEfecto());

                if ($rsEfectos != "") {
                    $response[$index]['desEfecto'] = utf8_encode($rsEfectos[0]->getDesEfecto());
                } else {
                    $response[$index]['desEfecto'] = utf8_encode("N/A");
                }

                $response[$index]['idImpOfeDelSolicitud'] = utf8_encode($violenciadegenero->getIdImpOfeDelSolicitud());

                $EfectosofendidosDto->setIdReferencia($violenciadegenero->getIdViolenciaDeGenero());
                $EfectosofendidosDto->setOrigen("V");
                $EfectosofendidosDto->setIdImpOfeDelSolicitud($violenciadegenero->getIdImpOfeDelSolicitud());
                $EfectosofendidosDto->setActivo('S');
                $rsEfectosofendidosDto = $EfectosofendidosDao->selectEfectosofendidos($EfectosofendidosDto);

                if ($rsEfectosofendidosDto != "") {

                    foreach ($rsEfectosofendidosDto as $indexefecto => $efectosofendidos) {

                        $detallesEfectosDto->setCveDetalleEfecto($efectosofendidos->getCveDetalleEfecto());
                        $detallesEfectosDto->setActivo('S');
                        $rsDetalleEfecto = $detallesEfectosDao->selectDetallesefectos($detallesEfectosDto);

                        $response[$index]['dataDetalle'][$indexefecto]['idEfectoOfendido'] = utf8_encode($efectosofendidos->getIdEfectoOfendido());
                        $response[$index]['dataDetalle'][$indexefecto]['cveDetalleEfecto'] = utf8_encode($efectosofendidos->getCveDetalleEfecto());

                        if ($rsDetalleEfecto != "") {
                            $response[$index]['dataDetalle'][$indexefecto]['desDetalleEfecto'] = utf8_encode($rsDetalleEfecto[0]->getDesDetalleEfecto());
                        } else {
                            $response[$index]['dataDetalle'][$indexefecto]['desDetalleEfecto'] = 'N/A';
                        }
                        $response[$index]['dataDetalle'][$indexefecto]['idImpOfeDelSolicitud'] = utf8_encode($efectosofendidos->getIdImpOfeDelSolicitud());
                        $response[$index]['dataDetalle'][$indexefecto]['idReferencia'] = utf8_encode($efectosofendidos->getIdReferencia());
                        $response[$index]['dataDetalle'][$indexefecto]['origen'] = utf8_encode($efectosofendidos->getOrigen());
                    }
                }

                $response[$index]['factorSocial'] = $this->consultaFactorSocial($violenciadegenero->getIdViolenciaDeGenero());
                $response[$index]['homicidioDoloso'] = $this->selectHomicidiosDolosos($violenciadegenero->getIdViolenciaDeGenero());
            }
        }

        return $response;
    }

    public function consultaFactorSocial($idViolenciaDeGenero) {
        $ViolenciafactoressocialesDto = new ViolenciafactoressocialesDTO();
        $ViolenciafactoressocialesDto->setIdViolenciaDeGenero($idViolenciaDeGenero);
        $ViolenciafactoressocialesDto->setActivo('S');
        $ViolenciaController = new ViolenciaController();
        $ViolenciafactoressocialesDto = $ViolenciaController->selectViolenciafactoressociales($ViolenciafactoressocialesDto);

        $response = [];
        if ($ViolenciafactoressocialesDto != "") {

            $factoresCulturalesDto = new FactoresculturalesDTO();
            $factoresCulturalesDao = new FactoresculturalesDAO();

            foreach ($ViolenciafactoressocialesDto as $index => $Violenciafactorsocial) {
                $factoresCulturalesDto->setCveFactorCultural($Violenciafactorsocial->getCveFactorCultural());
                $factoresCulturalesDto->setActivo('S');
                $rsFactor = $factoresCulturalesDao->selectFactoresculturales($factoresCulturalesDto);
                $response[$index]['idViolenciaFactorSocial'] = utf8_encode($Violenciafactorsocial->getIdViolenciaFactorSocial());
                $response[$index]['cveFactorCultural'] = utf8_encode($Violenciafactorsocial->getCveFactorCultural());

                if ($rsFactor != "") {
                    $response[$index]['desFactorCultural'] = utf8_encode($rsFactor[0]->getDesFactorCultural());
                } else {
                    $response[$index]['desFactorCultural'] = "N/A";
                }

                $response[$index]['idViolenciaDeGenero'] = utf8_encode($Violenciafactorsocial->getIdViolenciaDeGenero());
            }
        }

        return $response;
    }

    public function selectHomicidiosDolosos($idViolenciaDeGenero) {
        $ViolenciahomicidiosdolososDto = new ViolenciahomicidiosdolososDTO();
        $ViolenciahomicidiosdolososDto->setIdViolenciaDeGenero($idViolenciaDeGenero);
        $ViolenciahomicidiosdolososDto->setActivo('S');

        $ViolenciaController = new ViolenciaController();
        $ViolenciahomicidiosdolososDto = $ViolenciaController->selectViolenciahomicidiosdolosos($ViolenciahomicidiosdolososDto);

        $response = [];

        if ($ViolenciahomicidiosdolososDto != "") {

            $homicidiosDolososDto = new HomicidiosdolososDTO();
            $homicidiosDolososDao = new HomicidiosdolososDAO();


            foreach ($ViolenciahomicidiosdolososDto as $index => $Violenciahomicidiodoloso) {
                $homicidiosDolososDto->setCveHomicidioDoloso($Violenciahomicidiodoloso->getCveHomicidioDoloso());
                $homicidiosDolososDto->setActivo('S');
                $rsHomicidios = $homicidiosDolososDao->selectHomicidiosdolosos($homicidiosDolososDto);

                $response[$index]['idViolenciaHomicidioDoloso'] = utf8_encode($Violenciahomicidiodoloso->getIdViolenciaHomicidioDoloso());
                $response[$index]['idViolenciaDeGenero'] = utf8_encode($Violenciahomicidiodoloso->getIdViolenciaDeGenero());
                $response[$index]['cveHomicidioDoloso'] = utf8_encode($Violenciahomicidiodoloso->getCveHomicidioDoloso());
                if ($rsHomicidios != "") {
                    $response[$index]['desHomicidioDoloso'] = utf8_encode($rsHomicidios[0]->getDesHomicidioDoloso());
                } else {
                    $response[$index]['desHomicidioDoloso'] = 'N/A';
                }
            }
        }

        return $response;
    }

    public function getSexualesGeneral($idImpOfeDelSolicitud) {
        $SexualesDto = new SexualesDTO();
        $SexualesDto->setIdImpOfeDelSolicitud($idImpOfeDelSolicitud);
        $SexualesDto->setActivo('S');

        $ViolenciaController = new ViolenciaController();
        $SexualesDto = $ViolenciaController->selectSexuales($SexualesDto);

        $ambitoAcosoDto = new AmbitosacososDTO();
        $ambitoAcosoDao = new AmbitosacososDAO();

        $modalidadAcosoDto = new ModalidadesacososDTO();
        $modalidadAcosoDao = new ModalidadesacososDAO();

        $response = [];
        if ($SexualesDto != "") {

            foreach ($SexualesDto as $index => $Sexual) {
                $ambitoAcosoDto->setCveAmbitoAcoso($Sexual->getCveAmbitoAcoso());
                $ambitoAcosoDto->setActivo('S');
                $rsAmbito = $ambitoAcosoDao->selectAmbitosacosos($ambitoAcosoDto);

                $modalidadAcosoDto->setCveModalidadAcoso($Sexual->getCveModalidadAcoso());
                $modalidadAcosoDto->setActivo('S');
                $rsModalidad = $modalidadAcosoDao->selectModalidadesacosos($modalidadAcosoDto);


                $response[$index]['idSexual'] = utf8_encode($Sexual->getIdSexual());
                $response[$index]['cveModalidadAcoso'] = utf8_encode($Sexual->getCveModalidadAcoso());

                if ($rsModalidad != "") {
                    $response[$index]['desModalidad'] = utf8_encode($rsModalidad[0]->getDesModalidadAcoso());
                } else {
                    $response[$index]['desModalidad'] = 'N/A';
                }
                $response[$index]['cveAmbitoAcoso'] = utf8_encode($Sexual->getCveAmbitoAcoso());
                if ($rsAmbito != "") {
                    $response[$index]['desAmbito'] = utf8_encode($rsAmbito[0]->getDesAmbitoAcoso());
                } else {
                    $response[$index]['desAmbito'] = 'N/A';
                }

                $response[$index]['idImpOfeDelSolicitud'] = utf8_encode($Sexual->getIdImpOfeDelSolicitud());

                $response[$index]['conducta'] = $this->consultaConducta($Sexual->getIdSexual());
                $response[$index]['testigos'] = $this->consultaEfectosTestigos($Sexual->getIdSexual());
            }
        }

        return $response;
    }

    public function consultaConducta($idSexual) {
        $sexualesconductasDto = new SexualesconductasDTO();
        $sexualesconductasDto->setIdSexual($idSexual);
        $sexualesconductasDto->setActivo('S');

        $SexualesconductasDao = new SexualesconductasDAO();
        $sexualesconductasDto = $SexualesconductasDao->selectSexualesconductas($sexualesconductasDto);

        $response = [];

        if ($sexualesconductasDto != "") {

            $DetallessexualesconductasDao = new DetallessexualesconductasDAO();
            $detallessexualesconductasDto = new DetallessexualesconductasDTO();

            $conductasDao = new ConductasDAO();
            $conductasDto = new ConductasDTO();
            $detallesConductasDao = new DetallesconductasDAO();
            $detallesConductasDto = new DetallesconductasDTO();

            foreach ($sexualesconductasDto as $index => $sexualconducta) {
                $conductasDto->setCveConducta($sexualconducta->getCveConducta());
                $conductasDto->setActivo('S');
                $rsConducta = $conductasDao->selectConductas($conductasDto);

                $response[$index]['idSexualConducta'] = utf8_encode($sexualconducta->getIdSexualConducta());
                $response[$index]['idSexual'] = utf8_encode($sexualconducta->getIdSexual());
                $response[$index]['cveConducta'] = utf8_encode($sexualconducta->getCveConducta());
                if ($rsConducta != "") {
                    $response[$index]['desConducta'] = utf8_encode($rsConducta[0]->getDesConducta());
                } else {
                    $response[$index]['desConducta'] = 'N/A';
                }
                $response[$index]['dataDetalle'] = [];
                $detallessexualesconductasDto->setIdSexualConducta($sexualconducta->getIdSexualConducta());
                $detallessexualesconductas = $DetallessexualesconductasDao->selectDetallessexualesconductas($detallessexualesconductasDto);
                if ($detallessexualesconductas != "") {
                    foreach ($detallessexualesconductas as $indexdetalle => $detallessexualconducta) {
                        $detallesConductasDto->setCveDetalleConducta($detallessexualconducta->getCveDetalleConducta());
                        $rsDetalleConducta = $detallesConductasDao->selectDetallesconductas($detallesConductasDto);
                        $response[$index]['dataDetalle'][$indexdetalle]['idDetalleSexualConducta'] = utf8_encode($detallessexualconducta->getIdDetalleSexualConducta());
                        $response[$index]['dataDetalle'][$indexdetalle]['cveDetalleConducta'] = utf8_encode($detallessexualconducta->getCveDetalleConducta());

                        if ($rsDetalleConducta != "") {
                            $response[$index]['dataDetalle'][$indexdetalle]['desDetalleConducta'] = utf8_encode($rsDetalleConducta[0]->getDesDetalleConducta());
                        } else {
                            $response[$index]['dataDetalle'][$indexdetalle]['desDetalleConducta'] = 'N/A';
                        }
                        $response[$index]['dataDetalle'][$indexdetalle]['idSexualConducta'] = utf8_encode($detallessexualconducta->getIdSexualConducta());
                    }
                }
            }
        }

        return $response;
    }

    public function consultaEfectosTestigos($idSexual) {

        $TestigossexualesDto = new TestigossexualesDTO();
        $TestigossexualesDto->setIdSexual($idSexual);
        $TestigossexualesDto->setActivo('S');
        $ViolenciaController = new ViolenciaController();
        $rsTestigossexualesDto = $ViolenciaController->selectTestigossexuales($TestigossexualesDto);

        $response = [];
        if ($rsTestigossexualesDto != "") {

            foreach ($rsTestigossexualesDto as $index => $rsTestigosexual) {
                $response[$index]['idTestigoSexual'] = utf8_encode($rsTestigosexual->getIdTestigoSexual());
                $response[$index]['idSexual'] = utf8_encode($rsTestigosexual->getIdSexual());
                $response[$index]['paterno'] = utf8_encode($rsTestigosexual->getPaterno());
                $response[$index]['materno'] = utf8_encode($rsTestigosexual->getMaterno());
                $response[$index]['nombre'] = utf8_encode($rsTestigosexual->getNombre());
                $response[$index]['cveGenero'] = utf8_encode($rsTestigosexual->getCveGenero());
            }
        }

        return $response;
    }

    public function consultarResumen($idSolicitudAudiencia) {
        $solicitudAudiencia = $this->getSolicitudAudienciaById($idSolicitudAudiencia)[0]->toString();

        $imputadosSolicitud = $this->getImputadosByIdSolicitudAudiencia($idSolicitudAudiencia);

        $ofendidosSolicitud = $this->getOfendidosByIdSolicitudAudiencia($idSolicitudAudiencia);

        $delitosSolicitud = $this->getDelitosByIdSolicitud($idSolicitudAudiencia);

        $relacionSolicitud = $this->getRelacion($idSolicitudAudiencia);

        $response = [];

        $catAudiencia = $this->getDesCatAudiencia($solicitudAudiencia['cveCatAudiencia']);

        $desJuzgado = $this->getDesJuzgado($solicitudAudiencia['cveJuzgado']);
        $desTipoCarpeta = ($solicitudAudiencia['cveTipoCarpeta'] != '') ? $this->getDesTipoCarpeta($solicitudAudiencia['cveTipoCarpeta'])[0]->getDesTipoCarpeta() : 'NO APLICA';
        $numero = ((is_null($solicitudAudiencia['numero'])) ? 'N/A' : $solicitudAudiencia['numero']) . '/' . ((is_null($solicitudAudiencia['anio'])) ? 'N/A' : $solicitudAudiencia['anio']);
        $nuc = (is_null($solicitudAudiencia['nuc'])) ? 'N/A' : $solicitudAudiencia['nuc'];

        $response['datosAudiencia']['desCatAudiencia'] = ($catAudiencia == '') ? '' : utf8_encode($catAudiencia[0]->getDesCatAudiencia());
        $response['datosAudiencia']['desJuzgado'] = utf8_encode($desJuzgado[0]->getDesJuzgado());
        $response['datosAudiencia']['desTipoCarpeta'] = utf8_encode($desTipoCarpeta);
        $response['datosAudiencia']['numero'] = utf8_encode($numero);
        $response['datosAudiencia']['carpetaInvestigacion'] = utf8_encode((is_null($solicitudAudiencia['carpetaInv'])) ? 'N/A' : $solicitudAudiencia['carpetaInv']);
        $response['datosAudiencia']['nuc'] = utf8_encode($nuc);
        $response['datosAudiencia']['observaciones'] = utf8_encode(substr($solicitudAudiencia['observaciones'], 0, 500) . '...');

        if (count($imputadosSolicitud)) {
            foreach ($imputadosSolicitud as $imputado) {

                $tipoPersona = "";
                switch ($imputado->getCveTipoPersona()) {
                    case 1:
                        $tipoPersona = 'Fisica';
                        break;
                    case 2:
                        $tipoPersona = 'Moral';
                        break;
                    case 3:
                        $tipoPersona = 'Otra';
                        break;
                }

                $nombre = ($imputado->getCveTipoPersona() == 1) ? $imputado->getNombre() . ' ' . $imputado->getPaterno() . ' ' . $imputado->getMaterno() : $imputado->getNombreMoral();
                $genero = ($imputado->getCveGenero() == 1) ? 'Hombre' : (($imputado->getCveGenero() == 2) ? 'Mujer' : 'No Identificado');
                $domicilio = $this->getDomiciliosImputados($imputado->getIdImputadoSolicitud());

                $imputado_array = [
                    'tipoPersona' => utf8_encode($tipoPersona),
                    'nombre' => utf8_encode($nombre),
                    'genero' => utf8_encode($genero),
                    'domicilio' => $domicilio
                ];

                $response['imputados'][] = $imputado_array;
            }
        }


        if (count($ofendidosSolicitud)) {
            foreach ($ofendidosSolicitud as $ofendido) {

                $tipoPersona = "";

                $tipoPersona = "";

                switch ($ofendido->getCveTipoPersona()) {
                    case 1:
                        $tipoPersona = 'Fisica';
                        break;
                    case 2:
                        $tipoPersona = 'Moral';
                        break;
                    case 3:
                        $tipoPersona = 'Otra';
                        break;
                }


                $nombre = utf8_encode(($ofendido->getCveTipoPersona() == 1) ? $ofendido->getNombre() . ' ' . $ofendido->getPaterno() . ' ' . $ofendido->getMaterno() : $ofendido->getNombreMoral());
                $genero = ($ofendido->getCveGenero() == 1) ? 'Hombre' : (($ofendido->getCveGenero() == 2) ? 'Mujer' : 'No Identificado');
                $domicilio = $this->getDomiciliosOfendidos($ofendido->getIdOfendidoSolicitud());

                $ofendido_array = [
                    'tipoPersona' => utf8_encode($tipoPersona),
                    'nombre' => $nombre,
                    'genero' => utf8_encode($genero),
                    'domicilio' => $domicilio
                ];

                $response['ofendidos'][] = $ofendido_array;
            }
        }


        if (count($delitosSolicitud)) {
            foreach ($delitosSolicitud as $index => $delito) {
                $delito = $this->getDesDelito($delito->getCveDelito());
                $response['delitos'][] = utf8_encode($delito[0]->getDesDelito());
            }
        }


        if (count($relacionSolicitud)) {
            foreach ($relacionSolicitud as $index => $relacion) {


                $relacion_array = [
                    'imputado' => $this->getNameImputadoById($relacion->getIdImputadoSolicitud()),
                    'ofendido' => $this->getNameOfendidoById($relacion->getIdOfendidoSolicitud()),
                    'delito' => utf8_encode($this->getDesDelitoById($relacion->getIdDelitoSolicitud())),
                    'idImpOfeDelSolicitud' => $relacion->getIdImpOfeDelSolicitud()
                ];

                $response['relacion'][] = $relacion_array;
            }
        }

//violencia

        $response['violencia'] = $response['relacion'];

        foreach ($response['violencia'] as $index => $violencia) {

            $idImpOfeSolicitud = $violencia['idImpOfeDelSolicitud'];


            $violenciaGenero = $this->getViolenciaGenero($idImpOfeSolicitud);
            $trataPersonas = $this->getTrataPersonas($idImpOfeSolicitud);
            $efectos = $this->getSexualesGeneral($idImpOfeSolicitud);

            if (count($violenciaGenero) || count($trataPersonas) || count($efectos)) {

                $response['violencia'][$index]['violenciaGenero'] = $violenciaGenero;
                $response['violencia'][$index]['trataPersonas'] = $trataPersonas;
                $response['violencia'][$index]['efectos'] = $efectos;
            } else {
                unset($response['violencia'][$index]);
            }


//$response['violencia'][$index]['efectos']['testigos'] = '';//$this->getEfectosTestigos($idImpOfeSolicitud);
        }

        $response['violencia'] = array_values($response['violencia']);

//        print_r($response);

        return $response;
    }

    public function peticionDefensorWebService($resultWebSerice) {
        $textError = "";
        ob_start();
        try {
            $curl = curl_init();
            curl_setopt_array($curl, array(
                CURLOPT_PORT => "9000",
                CURLOPT_URL => "http://sigedepu.idpedomex.gob.mx:9000/ws/solicitud/save",
                CURLOPT_RETURNTRANSFER => true,
                CURLOPT_ENCODING => "",
                CURLOPT_MAXREDIRS => 10,
                CURLOPT_TIMEOUT => 30,
                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                CURLOPT_CUSTOMREQUEST => "POST",
                CURLOPT_POSTFIELDS => $resultWebSerice,
                CURLOPT_HTTPHEADER => array(
                    "Authorization: Basic cmVjZXB0b3Iuc29saWNpdHVkLnBqZTo5Qmc4WjloYU5vTW9XMmlR",
                    "cache-control: no-cache",
                    "content-type: application/x-www-form-urlencoded"
                ),
            ));



//            curl_setopt_array($curl, array(
//                CURLOPT_PORT => "9000",
//                CURLOPT_URL => "http://sigedepu.idpedomex.gob.mx:9000/ws/solicitud/save",
////                CURLOPT_PORT => "9010",
////                CURLOPT_URL => "http://mini.evomatik.net:9010/ws/solicitud/save",
//                CURLOPT_RETURNTRANSFER => true,
//                CURLOPT_ENCODING => "",
//                CURLOPT_MAXREDIRS => 10,
//                CURLOPT_TIMEOUT => 30,
//                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
//                CURLOPT_CUSTOMREQUEST => "POST",
//                CURLOPT_POSTFIELDS => $resultWebSerice,
//                CURLOPT_HTTPHEADER => array(
//                    "Authorization: Basic cmVjZXB0b3JTb2xpY2l0dWQxOnNlY3JldA==",
//                    "cache-control: no-cache",
//                    "content-type: application/x-www-form-urlencoded"
//                ),
//            ));

            $response = curl_exec($curl);

            $err = curl_error($curl);
            curl_close($curl);
            json_decode($response);
            if (json_last_error() == JSON_ERROR_SYNTAX) {
                throw new Exception("{error:Los parametros no son correctos}");
            } else {
                $textError = $response;
            }
        } catch (Exception $e) {
            ob_end_clean();
            $response = "{\"error\":\"" . $e->getMessage() . "\"}";
            $textError = $response;
        }/*  finally { */
        $bitacoraWsDto = new BitacorawsDTO();
        $BitacoraWsRespDto = new BitacorawsDTO();
        $bitacoraWsDao = new BitacorawsDAO();
        $fechaRegistro = date("Y-m-d H:i:s");
        $bitacoraWsDto->setCveAccionws(16);
        $bitacoraWsDto->setObservacionesOrigen($resultWebSerice);
        json_decode($textError);
        if (json_last_error() == JSON_ERROR_SYNTAX) {
            $bitacoraWsDto->setDescEstatusBitacoraws("Error. Respuesta invalida");
            $bitacoraWsDto->setObservacionesDestino(base64_encode($textError));
            $bitacoraWsDto->setHrefOrigen("SOLICITUD A DEFENSORIA DE OFICIO REGRESO ALGO DIFERENTE A UN JSON");
        } else {
            $bitacoraWsDto->setDescEstatusBitacoraws("respuesta valida");
            $bitacoraWsDto->setObservacionesDestino($textError);
            $bitacoraWsDto->setHrefOrigen("SOLICITUD A DEFENSORIA DE OFICIO REGRESO UN JSON VALIDO");
        }
        $bitacoraWsDto->setFechaRegistro($fechaRegistro);
        $rsBitacoraWsDto = $bitacoraWsDao->insertBitacoraws($bitacoraWsDto);
        /* } */
        return $response;
    }

    public function peticionDefensorWebServiceOfendido($resultWebSerice) {
//        $textError = "";
//        ob_start();
//        try {
//            $curl = curl_init();
//
//            curl_setopt_array($curl, array(
//                CURLOPT_PORT => "9010",
//                CURLOPT_URL => "http://mini.evomatik.net:9010/ws/solicitud/save",
////                CURLOPT_PORT => "9000",
////                CURLOPT_URL => "http://sigedepu.idpedomex.gob.mx:9000",
//                CURLOPT_RETURNTRANSFER => true,
//                CURLOPT_ENCODING => "",
//                CURLOPT_SSL_VERIFYPEER => false,
//                CURLOPT_SSL_VERIFYHOST => false,
//                CURLOPT_MAXREDIRS => 10,
//                CURLOPT_TIMEOUT => 30,
//                CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
//                CURLOPT_CUSTOMREQUEST => "POST",
//                CURLOPT_POSTFIELDS => $resultWebSerice,
//                CURLOPT_HTTPHEADER => array(
//                    "Authorization: Basic cmVjZXB0b3JTb2xpY2l0dWQxOnNlY3JldA==",
//                    "cache-control: no-cache",
//                    "content-type: application/x-www-form-urlencoded"
//                ),
//            ));
//
//            $response = curl_exec($curl);
//            $err = curl_error($curl);
//            curl_close($curl);
//            json_decode($response);
//            if (json_last_error() == JSON_ERROR_SYNTAX) {
//                throw new Exception("Error en la comunicacion con el webService");
//            } else {
//                $textError = $response;
//            }
//        } catch (Exception $e) {
//            ob_end_clean();
//            $response = $e->getMessage();
//            $response = "{\"error\":\"" . $e->getMessage() . "\"}";
//            $textError = $response;
//        } finally {
//            $bitacoraWsDto = new BitacorawsDTO();
//            $BitacoraWsRespDto = new BitacorawsDTO();
//            $bitacoraWsDao = new BitacorawsDAO();
//            $fechaRegistro = date("Y-m-d H:i:s");
//            $bitacoraWsDto->setCveAccionws(17);
//            $bitacoraWsDto->setObservacionesOrigen($resultWebSerice);
//            json_decode($textError);
//            if (json_last_error() == JSON_ERROR_SYNTAX) {
//                $bitacoraWsDto->setDescEstatusBitacoraws("Error. Respuesta invalida");
//                $bitacoraWsDto->setObservacionesDestino(base64_encode($textError));
//                $bitacoraWsDto->setHrefOrigen("SOLICITUD A DEFENSORIA DE OFICIO REGRESO ALGO DIFERENTE A UN JSON");
//            } else {
//                $bitacoraWsDto->setDescEstatusBitacoraws("respuesta valida");
//                $bitacoraWsDto->setObservacionesDestino($textError);
//                $bitacoraWsDto->setHrefOrigen("SOLICITUD A DEFENSORIA DE OFICIO REGRESO UN JSON VALIDO");
//            }
//            $bitacoraWsDto->setFechaRegistro($fechaRegistro);
//            $rsBitacoraWsDto = $bitacoraWsDao->insertBitacoraws($bitacoraWsDto);
//        }
//        return $response;
    }

    public function enviarSolicitudAudiencia($param, $imputadosReclusos) {
////718
        $SolicitudesaudienciasDto = new SolicitudesaudienciasDTO();
        $SolicitudesaudienciasDto->setIdSolicitudAudiencia($param['idSolicitudAudienca']);
        $SolicitudesaudienciasDto->setMismoJuzgador($param['mismoJuzgador']);
        $SolicitudesaudienciasDto->setTribunal($param['tribunal']);
        $SolicitudesaudienciasController = new SolicitudesaudienciasController();
        $response = $SolicitudesaudienciasController->enviarSolicitud($SolicitudesaudienciasDto, $imputadosReclusos);

        $data = json_decode($response, true);
        if ($data['status'] == 'ok') {
            $audienicasDto = new AudienciasDTO();
            $audienicasDao = new AudienciasDAO();
            $audienicasDto->setIdAudiencia($data['idAudiencia']);
            $audienicasDto = $audienicasDao->selectAudiencias($audienicasDto);
            if ($audienicasDto != "") {
                if (($audienicasDto[0]->getCveCatAudiencia() != 60) && ($audienicasDto[0]->getCveCatAudiencia() != 61) &&
                        ($audienicasDto[0]->getCveCatAudiencia() != 128) && ($audienicasDto[0]->getCveCatAudiencia() != 133) &&
                        ($audienicasDto[0]->getCveCatAudiencia() != 156)) {



                    $solicitudesAudienciasDto = new SolicitudesaudienciasDTO();
                    $solicitudesAudienciasDao = new SolicitudesaudienciasDAO();

                    $solicitudesAudienciasDto->setIdSolicitudAudiencia($audienicasDto[0]->getIdSolicitudAudiencia());
                    $solicitudesAudienciasDto = $solicitudesAudienciasDao->selectSolicitudesaudiencias($solicitudesAudienciasDto);
                    if ($solicitudesAudienciasDto != "") {

                        /*                         * ******************************************************* */
                        /*                         * ******************************************************* */
                        /*                         * ******************************************************* */
                        /*                         * ******************************************************* */
                        ///////Se hace la solicitud para los defensores de los imputados
                        $imputadosSolicitudesDto = new ImputadossolicitudesDTO();
                        $imputadosSolicitudesDao = new ImputadossolicitudesDAO();

                        $imputadosSolicitudesDto->setIdSolicitudAudiencia($audienicasDto[0]->getIdSolicitudAudiencia());
                        $imputadosSolicitudesDto->setActivo("S");
                        $imputadosSolicitudesDto = $imputadosSolicitudesDao->selectImputadossolicitudes($imputadosSolicitudesDto);
                        if ($imputadosSolicitudesDto != "") {
                            ///Juzgado de la solicitud
                            $juzgadosDto = new JuzgadosDTO();
                            $juzgadosDao = new JuzgadosDAO();

                            $juzgadosDto->setCveJuzgado($audienicasDto[0]->getCveJuzgado());
                            $juzgadosAuxDto = $juzgadosDao->selectJuzgados($juzgadosDto);
                            if ($juzgadosAuxDto != "") {
                                $desJuzgado = utf8_encode($juzgadosAuxDto[0]->getDesJuzgado());
                            } else {
                                $desJuzgado = "N/A";
                            }

                            /////Fecha y hora de la audiencia
                            if ($audienicasDto[0]->getFechaInicial() != "") {
                                $div = explode(" ", $audienicasDto[0]->getFechaInicial());
                                $fechaIn = $this->fecha($div[0]);
                                $horaIn = $div[1];
                            } else {
                                $fechaIn = "";
                                $horaIn = "";
                            }
                            $fechaSolicitud = date("d/m/Y");
                            $horaSolicitud = date("H:i:s");
                            /////Descripcion del distrito
                            $distritosDto = new DistritosDTO();
                            $distritosDao = new DistritosDAO();

                            $distritosDto->setCveDistrito($juzgadosAuxDto[0]->getCveDistrito());
                            $rsDistritosDto = $distritosDao->selectDistritos($distritosDto);
                            if ($rsDistritosDto != "") {
                                $desDistrito = utf8_encode($rsDistritosDto[0]->getDesDistrito());
                            } else {
                                $desDistrito = "";
                            }


                            $defensoresDto = new DefensoresimputadossolicitudesDTO();
                            $defensoresimputadossolicitudesAuxDto = new DefensoresimputadossolicitudesDTO();
                            $defensoresDao = new DefensoresimputadossolicitudesDAO();

                            foreach ($imputadosSolicitudesDto as $imputados) {
                                $defensoresDto->setIdImputadoSolicitud($imputados->getIdImputadoSolicitud());
                                $defensoresDto->setActivo('S');
                                $rsDefensores = $defensoresDao->selectDefensoresimputadossolicitudes($defensoresDto);
                                if ($rsDefensores != "") {
                                    foreach ($rsDefensores as $rsDefensor) {
                                        if ((int) $rsDefensor->getCveTipoDefensor() == 5 || (int) $rsDefensor->getCveTipoDefensor() == 6) {
                                            $fecha = date("d/m/Y");
                                            $hora = date("H:i:s");


                                            if ($imputados->getCveTipoPersona() == 1) {
                                                $nombre = utf8_encode($imputados->getNombre());
                                                $paterno = utf8_encode($imputados->getPaterno());
                                                $materno = utf8_encode($imputados->getMaterno());
                                            } else {
                                                $nombre = utf8_encode($imputados->getNombreMoral());
                                                $paterno = "";
                                                $materno = "";
                                            }

                                            if ($solicitudesAudienciasDto[0]->getCveUsuario() == "7137") {
                                                $resultWebSerice = "idReferencia=" . $rsDefensor->getIdDefensorImputadoSolicitud() .
                                                        "&tipoPeticion=nuevo" .
                                                        "&nombreRemite=" . "pj" .
                                                        "&procedencia=" . "PJE" .
                                                        "&cargoSolicita=" . "" .
                                                        "&fechaSolicitud=" . $fechaSolicitud .
                                                        "&horaLlegada=" . $horaSolicitud .
                                                        "&fechaAudiencia=" . $fechaIn .
                                                        "&horaAudiencia=" . $horaIn .
                                                        "&nombre=" . $nombre .
                                                        "&paterno=" . $paterno .
                                                        "&materno=" . $materno .
                                                        "&NUC=" . $solicitudesAudienciasDto[0]->getNuc() .
                                                        "&distritoJudicial=" . $desDistrito .
                                                        "&juzgado=" . $desJuzgado .
                                                        "&curp=" . "" .
                                                        "&sexo=" . "";
                                            } else {
                                                $resultWebSerice = "idReferencia=" . $rsDefensor->getIdDefensorImputadoSolicitud() .
                                                        "&tipoPeticion=nuevo" .
                                                        "&nombreRemite=" . utf8_encode($_SESSION["Nombre"]) .
                                                        "&procedencia=" . "PJE" .
                                                        "&cargoSolicita=" . "" .
                                                        "&fechaSolicitud=" . $fechaSolicitud .
                                                        "&horaLlegada=" . $horaSolicitud .
                                                        "&fechaAudiencia=" . $fechaIn .
                                                        "&horaAudiencia=" . $horaIn .
                                                        "&nombre=" . $nombre .
                                                        "&paterno=" . $paterno .
                                                        "&materno=" . $materno .
                                                        "&NUC=" . $solicitudesAudienciasDto[0]->getNuc() .
                                                        "&distritoJudicial=" . $desDistrito .
                                                        "&juzgado=" . $desJuzgado .
                                                        "&curp=" . "" .
                                                        "&sexo=" . "";
                                            }

                                            $respuestaWebService = ($this->peticionDefensorWebService($resultWebSerice));
                                            if (json_last_error() == JSON_ERROR_NONE) {
                                                $rs = json_decode($respuestaWebService, true);
                                                if (array_key_exists("error", $rs)) {
                                                    
                                                } else {
                                                    $respuesta = "|";
                                                    $respuestaWebService = json_decode($respuestaWebService);
                                                    foreach ($respuestaWebService as $respuestaWeb) {
                                                        $respuesta .= $respuestaWeb . "|";
                                                    }

                                                    $respuesta = substr($respuesta, 0, -1);
                                                    $defensoresimputadossolicitudesAuxDto->setIdDefensorImputadoSolicitud($rsDefensor->getIdDefensorImputadoSolicitud());
                                                    $defensoresimputadossolicitudesAuxDto->setTelefono(utf8_decode($respuesta));
                                                    $rsDefensor = $defensoresDao->updateDefensoresimputadossolicitudesRSP($defensoresimputadossolicitudesAuxDto);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            ////aqui temrina el if
        }
        return $response;
    }

    public function consultaAcuseJSON($param) {
        $idSolicitudAudiencia = $param["idSolicitudAudienca"];

        $solicitudesAudienciasDto = new SolicitudesaudienciasDTO();
        $solicitudesAudienciasDao = new SolicitudesaudienciasDAO();


        $json = "";
        $i = 1;
        $o = 1;


        $solicitudesAudienciasDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
        $solicitudesAudienciasDto = $solicitudesAudienciasDao->selectSolicitudesaudiencias($solicitudesAudienciasDto);

        if ($solicitudesAudienciasDto != "") {

            $audienciasDto = new AudienciasDTO();
            $audienciasDao = new AudienciasDAO();

            $imputadosSolicitudesDto = new ImputadossolicitudesDTO();
            $imputadosSolicitudesDao = new ImputadossolicitudesDAO();

            $ofendidoSolicitudDao = new OfendidossolicitudesDAO();
            $ofendidoSolicitudDto = new OfendidossolicitudesDTO();

            $domiciliosimputadosDto = new DomiciliosimputadossolicitudesDTO();
            $domiciliosimputadosDao = new DomiciliosimputadossolicitudesDAO();

            $DomiciliosOfendidosDto = new DomiciliosofendidossolicitudesDTO();
            $DomiciliosOfendidosDao = new DomiciliosofendidossolicitudesDAO();

            $defensoresImputadosDto = new DefensoresimputadossolicitudesDTO();
            $defensoresImputadosDao = new DefensoresimputadossolicitudesDAO();

            $defensoresOfendidosDto = new DefensoresofendidossolicitudesDTO();
            $defensoresOfendidosDao = new DefensoresofendidossolicitudesDAO();


            $json .= "{";
            $json .= '"status":"ok",';
            $json .= '"msj":"resultados",';
            $json .= '"totalCount":"' . count($solicitudesAudienciasDto) . '",';
            $json .= '"solicitudaudiencia":[';
            $json .= "{";
            $json .= '"cveEstatusSolicitud":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getCveEstatusSolicitud())) . ",";
            $json .= '"cveConsignacion":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getCveConsignacion())) . ",";
            $json .= '"cveTipoAudiencia":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getCveTipoAudiencia())) . ",";
            $json .= '"cveNaturaleza":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getCveNaturaleza())) . ",";
            $json .= '"cveEtapaProcesal":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getCveEtapaProcesal())) . ",";
            $json .= '"cveUsuario":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getCveUsuario())) . ",";
            $json .= '"fechaRegisto":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getFechaRegistro())) . ",";
            $json .= '"observaciones":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getObservaciones())) . ",";
            $json .= '"carpetaInv":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getCarpetaInv())) . ",";
            $json .= '"cveNaturaleza":' . json_encode(utf8_encode($solicitudesAudienciasDto[0]->getCveNaturaleza())) . ",";
            $json .= '"datosAudiencia":[{';
            $audienciasDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
            $audienciasDto = $audienciasDao->selectAudiencias($audienciasDto);
            if ($audienciasDto != "") {
                $json .= '"juzgadoDesahoga":' . json_encode(utf8_encode($audienciasDto[0]->getCveJuzgadoDesahoga())) . ",";
                $json .= '"cveTipoCarpeta":' . json_encode(utf8_encode($audienciasDto[0]->getCveTipoCarpeta())) . ",";
                $json .= '"numero":' . json_encode(utf8_encode($audienciasDto[0]->getNumero())) . ",";
                $json .= '"anio":' . json_encode(utf8_encode($audienciasDto[0]->getAnio())) . ",";
                $json .= '"cveCatAudiencia":' . json_encode(utf8_encode($audienciasDto[0]->getCveCatAudiencia())) . ",";
                $json .= '"fechaInicial":' . json_encode(utf8_encode($audienciasDto[0]->getFechaInicial())) . ",";
                $json .= '"fechaFianl":' . json_encode(utf8_encode($audienciasDto[0]->getFechaFinal())) . ",";
                $json .= '"detenido":' . json_encode(utf8_encode($audienciasDto[0]->getDetenido())) . ",";
                $json .= '"cveUsuario":' . json_encode(utf8_encode($audienciasDto[0]->getCveUsuario())) . ",";
                $json .= '"cveEstatusAudiencia":' . json_encode(utf8_encode($audienciasDto[0]->getCveEstatusAudiencia())) . ",";
                $json .= '"cveSala":' . json_encode(utf8_encode($audienciasDto[0]->getCveSala())) . "";
            } else {
                $mensaje = "No se encontraros datos de la audiencia";
            }
            $json .= "}],";
            $json .= '"imputados":[';
            $imputadosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
            $imputadosSolicitudesDto = $imputadosSolicitudesDao->selectImputadossolicitudes($imputadosSolicitudesDto);
            if ($imputadosSolicitudesDto != "") {

                foreach ($imputadosSolicitudesDto as $imputado) {
                    $x = 1;
                    $j = 1;
                    $json .= "{";
                    $json .= '"cveTipoPersona":' . json_encode(utf8_encode($imputado->getCveTipoPersona())) . ",";
                    $json .= '"nombre":' . json_encode(utf8_encode($imputado->getNombre())) . ",";
                    $json .= '"paterno":' . json_encode(utf8_encode($imputado->getPaterno())) . ",";
                    $json .= '"materno":' . json_encode(utf8_encode($imputado->getMaterno())) . ",";
                    $json .= '"nombreMoral":' . json_encode(utf8_encode($imputado->getNombreMoral())) . ",";
                    $json .= '"alias":' . json_encode(utf8_encode($imputado->getAlias())) . ",";

                    $json .= '"domicilio":[';

                    $domiciliosimputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                    $domiciliosimputadosDto->setActivo("S");
                    $rsDomiciliosimputadosDto = $domiciliosimputadosDao->selectDomiciliosimputadossolicitudes($domiciliosimputadosDto);
                    if ($rsDomiciliosimputadosDto != "") {
                        foreach ($rsDomiciliosimputadosDto as $domicilioImputado) {
                            $json .= "{";
                            $json .= '"direccion":' . json_encode(utf8_encode($domicilioImputado->getDireccion())) . ",";
                            $json .= '"colonia":' . json_encode(utf8_encode($domicilioImputado->getColonia())) . ",";
                            $json .= '"numInterior":' . json_encode(utf8_encode($domicilioImputado->getNumInterior())) . ",";
                            $json .= '"numExterior":' . json_encode(utf8_encode($domicilioImputado->getNumExterior())) . ",";
                            $json .= '"cp":' . json_encode(utf8_encode($domicilioImputado->getCp())) . "";
                            $json .= "}";
                            $x ++;
                            if ($x <= count($rsDomiciliosimputadosDto)) {
                                $json .= ",";
                            }
                        }
                    } else {
                        $mensaje = "No se encontraron domicilios del imputado";
                    }
                    $json .= "],";
                    $json .= '"defensores":[';
                    $defensoresImputadosDto->setActivo("S");
                    $defensoresImputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                    $rsDefensoresImputadosDto = $defensoresImputadosDao->selectDefensoresimputadossolicitudes($defensoresImputadosDto);
                    if ($rsDefensoresImputadosDto != "") {
                        foreach ($rsDefensoresImputadosDto as $defensorImputados) {
                            $json .= "{";
                            $json .= '"tipoDefensor":' . json_encode(utf8_encode($defensorImputados->getCveTipoDefensor())) . ",";
                            $json .= '"nombre":' . json_encode(utf8_encode($defensorImputados->getNombre())) . "";
                            $json .= "}";
                            $j ++;
                            if ($j <= count($rsDefensoresImputadosDto)) {
                                $json .= ",";
                            }
                        }
                    }

                    $json .= "]";
                    $json .= "}";
                    $i ++;
                    if ($i <= count($imputadosSolicitudesDto)) {
                        $json .= ",";
                    }
                }
            } else {
                $mensaje = "No se encontraros datos del imputado";
            }
            $json .= "],";
            $json .= '"ofendidos":[';
            $ofendidoSolicitudDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
            $ofendidoSolicitudDto->setActivo("S");
            $ofendidoSolicitudDto = $ofendidoSolicitudDao->selectOfendidossolicitudes($ofendidoSolicitudDto);
            if ($ofendidoSolicitudDto != "") {
                foreach ($ofendidoSolicitudDto as $ofendido) {
                    $x = 1;
                    $j = 1;
                    $json .= "{";
                    $json .= '"cveTipoPersona":' . json_encode(utf8_encode($ofendido->getCveTipoPersona())) . ",";
                    $json .= '"nombre":' . json_encode(utf8_encode($ofendido->getNombre())) . ",";
                    $json .= '"paterno":' . json_encode(utf8_encode($ofendido->getPaterno())) . ",";
                    $json .= '"materno":' . json_encode(utf8_encode($ofendido->getMaterno())) . ",";
                    $json .= '"nombreMoral":' . json_encode(utf8_encode($ofendido->getNombreMoral())) . ",";
                    $json .= '"domicilio":[';
                    $DomiciliosOfendidosDto->setActivo("S");
                    $DomiciliosOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                    $rsDomiciliosOfendidosDto = $DomiciliosOfendidosDao->selectDomiciliosofendidossolicitudes($DomiciliosOfendidosDto);
                    if ($rsDomiciliosOfendidosDto != "") {
                        foreach ($rsDomiciliosOfendidosDto as $domicilioOfendido) {
                            $json .= "{";
                            $json .= '"direccion":' . json_encode(utf8_encode($domicilioOfendido->getDireccion())) . ",";
                            $json .= '"colonia":' . json_encode(utf8_encode($domicilioOfendido->getColonia())) . ",";
                            $json .= '"numInterior":' . json_encode(utf8_encode($domicilioOfendido->getNumInterior())) . ",";
                            $json .= '"numExterior":' . json_encode(utf8_encode($domicilioOfendido->getNumExterior())) . ",";
                            $json .= '"cp":' . json_encode(utf8_encode($domicilioOfendido->getCp())) . "";
                            $json .= "}";
                            $x ++;
                            if ($x <= count($rsDomiciliosOfendidosDto)) {
                                $json .= ",";
                            }
                        }
                    } else {
                        $mensaje = "No se encontraron domicilios del ofendido";
                    }
                    $json .= "],";
                    $json .= '"defensores":[';
                    $defensoresOfendidosDto->setActivo("S");
                    $defensoresOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                    $rsDefensoresOfendidosDto = $defensoresOfendidosDao->selectDefensoresofendidossolicitudes($defensoresOfendidosDto);
                    if ($rsDefensoresOfendidosDto != "") {
                        foreach ($rsDefensoresOfendidosDto as $defensor) {
                            $json .= "{";
                            $json .= '"tipoDefensor":' . json_encode(utf8_encode($defensor->getCveTipoAsesor())) . ",";
                            $json .= '"nombre":' . json_encode(utf8_encode($defensor->getNombre())) . "";
                            $json .= "}";
                            $j ++;
                            if ($j <= count($rsDefensoresOfendidosDto)) {
                                $json .= ",";
                            }
                        }
                    }


                    $json .= "]";
                    $json .= "}";
                    $o ++;
                    if ($o <= count($ofendidoSolicitudDto)) {
                        $json .= ",";
                    }
                }
            } else {
                $mensaje = "No se encontraros datos del ofendido";
            }
            $json .= "]";
///////////////////aqui temrina json
            $json .= "}";
            $json .= "]";
            $json .= "}";
        } else {
            $mensaje = "No se encontro la solicitud audiencia con ese id";
        }

        return $json;
    }

    public function consultaAcuse($param) {
        $idSolicitudAudiencia = $param["idSolicitudAudiencaGet"];
        $html = "";
        $solicitudesAudienciasDto = new SolicitudesaudienciasDTO();
        $solicitudesAudienciasDao = new SolicitudesaudienciasDAO();

        $solicitudesAudienciasDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
        $solicitudesAudienciasDto = $solicitudesAudienciasDao->selectSolicitudesaudiencias($solicitudesAudienciasDto);

        if ($solicitudesAudienciasDto != "") {
            $audienciasDto = new AudienciasDTO();
            $audienciasDao = new AudienciasDAO();
            $audienciasDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
            $audienciasDto = $audienciasDao->selectAudiencias($audienciasDto);
            if ($audienciasDto != "") {
                $usuarioWS = new UsuarioCliente();

                $imputadosSolicitudesDto = new ImputadossolicitudesDTO();
                $imputadosSolicitudesDao = new ImputadossolicitudesDAO();

                $ofendidoSolicitudDao = new OfendidossolicitudesDAO();
                $ofendidoSolicitudDto = new OfendidossolicitudesDTO();

                $domiciliosimputadosDto = new DomiciliosimputadossolicitudesDTO();
                $domiciliosimputadosDao = new DomiciliosimputadossolicitudesDAO();

                $DomiciliosOfendidosDto = new DomiciliosofendidossolicitudesDTO();
                $DomiciliosOfendidosDao = new DomiciliosofendidossolicitudesDAO();

                $defensoresImputadosDto = new DefensoresimputadossolicitudesDTO();
                $defensoresImputadosDao = new DefensoresimputadossolicitudesDAO();

                $defensoresOfendidosDto = new DefensoresofendidossolicitudesDTO();
                $defensoresOfendidosDao = new DefensoresofendidossolicitudesDAO();

                $delitosSolicitudesDto = new DelitossolicitudesDTO();
                $delitosSolicitudesDao = new DelitossolicitudesDAO();


                $tipospartesDto = new TipospartesDTO();
                $tipospartesDao = new TipospartesDAO();

                $ceresosDto = new CeresosDTO();
                $ceresosDao = new CeresosDAO();
                ////////////////////////////////////////////////////////////////
                //
                //
                //
                //
                //
                //
                ////////////////////////////Se define el tipo de carpeta
                if ($audienciasDto[0]->getCveTipoCarpeta() != "" && $audienciasDto[0]->getCveTipoCarpeta() != 0) {
                    if ($audienciasDto[0]->getCveTipoCarpeta() == 1) {
                        $numAuxiliar = $audienciasDto[0]->getNumero() . "/" . $audienciasDto[0]->getAnio();
                        $numCausa = "N/A";
                    } else {
                        $numCausa = $audienciasDto[0]->getNumero() . "/" . $audienciasDto[0]->getAnio();
                        $numAuxiliar = "N/A";
                    }
                } else {
                    $numAuxiliar = "N/A";
                    $numCausa = "N/A";
                }


                ////////////////////////////traer la descripcion de la solicitud
                $catAudiencasDto = new CataudienciasDTO();
                $catAudiencasDao = new CataudienciasDAO();

                $catAudiencasDto->setCveCatAudiencia($audienciasDto[0]->getCveCatAudiencia());
                $rsCatAudienciasDto = $catAudiencasDao->selectCataudiencias($catAudiencasDto);
                if ($rsCatAudienciasDto != "") {
                    $rsDesAudiencia = utf8_encode($rsCatAudienciasDto[0]->getDesCatAudiencia());
                } else {
                    $rsDesAudiencia = "N/A";
                }

                ///////////////////////////Traer la descripcion de la naturaleza
                $naturalezasDto = new NaturalezasDTO();
                $naturalezasDao = new NaturalezasDAO();
                $naturalezasDto->setCveNaturaleza($solicitudesAudienciasDto[0]->getCveNaturaleza());
                $rsNaturalezasDto = $naturalezasDao->selectNaturalezas($naturalezasDto);
                if ($rsNaturalezasDto != "") {
                    $rsDesNaturaleza = utf8_encode($rsNaturalezasDto[0]->getDesNaturaleza());
                } else {
                    $rsDesNaturaleza = "N/A";
                }
                ////definir la consignacion
                if ($solicitudesAudienciasDto[0]->getCveConsignacion() == 1 || $solicitudesAudienciasDto[0]->getCveConsignacion() == 3) {
                    $consignacion = "S";
                } else {
                    $consignacion = "N";
                }
                /////////////////////////////////////Descripcion de la audiencia
                $estatusAudienciasDto = new EstatusaudienciasDTO();
                $estatusAudienciasDao = new EstatusaudienciasDAO();
                $estatusAudienciasDto->setCveEstatusAudiencia($audienciasDto[0]->getCveEstatusAudiencia());
                $rsEstatusAudienciasDto = $estatusAudienciasDao->selectEstatusaudiencias($estatusAudienciasDto);
                if ($rsEstatusAudienciasDto != "") {
                    $rsEstatusAudiencia = utf8_encode($rsEstatusAudienciasDto[0]->getDesEstatusAudiencia());
                } else {
                    $rsEstatusAudiencia = "N/A";
                }

                /////////////////////////////////////Descripcion del estatus de la solicitud
                $estatusSolicitudesDto = new EstatussolicitudesDTO();
                $estatusSolicitudesDao = new EstatussolicitudesDAO();
                $estatusSolicitudesDto->setCveEstatusSolicitud($solicitudesAudienciasDto[0]->getCveEstatusSolicitud());
                $rsEstatusSolicitudesDto = $estatusSolicitudesDao->selectEstatussolicitudes($estatusSolicitudesDto);
                if ($rsEstatusSolicitudesDto != "") {
                    $rsEstatusSolicitudes = utf8_encode($rsEstatusSolicitudesDto[0]->getDesEstatusSolicitud());
                } else {
                    $rsEstatusSolicitudes = "N/A";
                }

                ////////////////////////////////Descripcion del tipo de audiencia
                $tiposAudienciasDto = new TiposaudienciasDTO();
                $tiposAudienciasDao = new TiposaudienciasDAO();

                $tiposAudienciasDto->setCveTipoAudiencia($solicitudesAudienciasDto[0]->getCveTipoAudiencia());
                $rsTiposAudienciasDto = $tiposAudienciasDao->selectTiposaudiencias($tiposAudienciasDto);
                if ($rsTiposAudienciasDto != "") {
                    $tiposAudiencia = utf8_encode($rsTiposAudienciasDto[0]->getDesTipoAudiencia());
                } else {
                    $tiposAudiencia = "N/A";
                }

                //////////////////////////////////////////////////Etapa procesal
                $etapaProcesalDto = new EtapasprocesalesDTO();
                $etapaProcesalDao = new EtapasprocesalesDAO();
                $etapaProcesalDto->setCveEtapaProcesal($solicitudesAudienciasDto[0]->getCveEtapaProcesal());
                $rsEtapaProcesalDto = $etapaProcesalDao->selectEtapasprocesales($etapaProcesalDto);
                if ($rsEtapaProcesalDto != "") {
                    $rsDesEtapaProcesal = utf8_encode($rsEtapaProcesalDto[0]->getDesEtapaProcesal());
                } else {
                    $rsDesEtapaProcesal = "N/A";
                }
                //////fecha y hora de la solicitud
                $fecha = explode(" ", $solicitudesAudienciasDto[0]->getFechaRegistro());
                $fechaFroamto = $this->fechaNormal($fecha[0]);
                ////Nombre de los solicitantes
                $usuario = $usuarioWS->getUsuarios($solicitudesAudienciasDto[0]->getCveUsuario());
                $usuario = json_decode($usuario, true);
                if ($usuario != "") {
                    $nombreSolicitante = utf8_encode($usuario["data"][0]["nombre"] . " " . $usuario["data"][0]["paterno"] . " " . $usuario["data"][0]["materno"]);
                } else {
                    $nombreSolicitante = "N/A";
                }
                $usuario1 = $usuarioWS->getUsuarios($audienciasDto[0]->getCveUsuario());
                $usuario1 = json_decode($usuario1, true);
                if ($usuario1 != "") {
                    $nombreSolicitante1 = utf8_encode($usuario["data"][0]["nombre"] . " " . $usuario["data"][0]["paterno"] . " " . $usuario["data"][0]["materno"]);
                } else {
                    $nombreSolicitante1 = "N/A";
                }


                $html .= "<style type='text/css'>";
                $html .= ".tablaPrint{";
                $html .= "font-family: Arial;";
                $html .= "font-size: 12px;";
                $html .= "border: 1px solid #000;";
                $html .= "border-collapse: collapse;";
                $html .= "}";
                $html .= "</style>";

                ///////////////////////////////////////Logos////////////////////
                $html .= "<table border='0' width='100%' >";
                $html .= "<tr>";
                $html .= "<td><img src='../../../vistas/img/logoPj.png'></td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE AUDIENCIAS////////////////////
                $html .= " <table class='tablaPrint' border='1' width='100%' >";
                $html .= "<tr><td colspan='4' align='center'><b>DATOS DE LA AUDIENCIA<b></td></tr>";
                $html .= "<tr>";
                if ($audienciasDto[0]->getCveTipoCarpeta() == '6') {
                    $html .= "<td width='20%'>Toca:</td>";
                } else {
                    $html .= "<td width='20%'>Causa:</td>";
                }

                $html .= "<td width='30%'>" . $numCausa . "</td>";
                $html .= "<td width='20%'>Num Auxiliar:</td>";
                $html .= "<td width='30%'>" . $numAuxiliar . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Audiencia:</td>";
                $html .= "<td colspan='3'>" . $rsDesAudiencia . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fecha audiencia:</td>";
                $html .= "<td>" . $this->fechaHoraNormal($audienciasDto[0]->getFechaInicial()) . "</td>";
                $html .= "<td>Fecha final</td>";
                $html .= "<td>" . $this->fechaHoraNormal($audienciasDto[0]->getFechaFinal()) . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Sala:</td>";

                if (isset($param['toca']) && $param['toca'] == 'S') {

                    $salasDao = new SalasDAO();
                    $salasDto = new SalasDto();

                    $salasDto->setCveSala($audienciasDto[0]->getCveSala());

                    $selectSalas = $salasDao->selectSalas($salasDto);

                    $desSala = 'POR DEFINIR';
                    if ($selectSalas != '') {
                        $desSala = $selectSalas[0]->getDesSala();
                    }

                    $html .= "<td colspan='3'>" . $desSala . "</td>";
                } else {
                    $html .= "<td colspan='3'>POR DEFINIR</td>";
                }

                $html .= "</tr>";

                if (isset($param['toca']) && $param['toca'] == 'S') {

                    $html .= "<tr>";

                    if (isset($param['leyendajuez']) && $param['leyendajuez'] != '') {
                        $html .= "<td>" . $param['leyendajuez'] . "</td>";
                    } else {
                        $html .= "<td>Magistrado(s):</td>";
                    }


                    $magistrados = "";

                    $audienciasJuzgadorDao = new AudienciasjuzgadorDAO();
                    $audienciasJuzgadorDto = new AudienciasjuzgadorDTO();

                    $audienciasJuzgadorDto->setIdAudiencia($audienciasDto[0]->getIdAudiencia());

                    $selectAudienciasJuzgadores = $audienciasJuzgadorDao->selectAudienciasjuzgador($audienciasJuzgadorDto);

                    if ($selectAudienciasJuzgadores != '') {

                        foreach ($selectAudienciasJuzgadores as $audienciaJuzgador) {


                            $funcionesJuzgadoresDao = new FuncionesjuzgadoresDAO();
                            $funcionesJuzgadoresDto = new FuncionesjuzgadoresDTO();

                            $funcionesJuzgadoresDto->setCveFuncionJuzgador($audienciaJuzgador->getCveFuncionJuzgador());

                            $selectFuncionJuzgador = $funcionesJuzgadoresDao->selectFuncionesjuzgadores($funcionesJuzgadoresDto);

                            $funcion = '';
                            $nombre = '';

                            if ($selectFuncionJuzgador != '') {
                                $funcion = $selectFuncionJuzgador[0]->getDesFuncionJuzgador();
                            }

                            $juzgadoresDao = new JuzgadoresDAO();
                            $juzgadoresDto = new JuzgadoresDTO();

                            $juzgadoresDto->setIdJuzgador($audienciaJuzgador->getIdJuzgador());

                            $selectJuzgadores = $juzgadoresDao->selectJuzgadores($juzgadoresDto);

                            if ($selectJuzgadores != '') {
                                $nombre = $selectJuzgadores[0]->getNombre() . ' ' . $selectJuzgadores[0]->getPaterno() . ' ' . $selectJuzgadores[0]->getMaterno();
                            }


                            $magistrados .= $funcion . ': ' . $nombre . '<br>';
                        }
                    }

                    $html .= "<td>" . $magistrados . "</td>";

                    $html .= "</tr>";
                }

                $html .= "<tr>";
                $html .= "<td>Carpeta Inv:</td>";
                if ($solicitudesAudienciasDto[0]->getCarpetaInv() != "") {
                    $html .= "<td>" . $solicitudesAudienciasDto[0]->getCarpetaInv() . "</td>";
                } else {
                    $html .= "<td>N/A</td>";
                }
                $html .= "<td>NUC:</td>";
                if ($solicitudesAudienciasDto[0]->getNuc() != "") {
                    $html .= "<td>" . $solicitudesAudienciasDto[0]->getNuc() . "</td>";
                } else {
                    $html .= "<td>N/A</td>";
                }
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Naturaleza:</td>";
                $html .= "<td>" . $rsDesNaturaleza . "</td>";
                $html .= "<td>&#191;Detenido?</td>";

                $html .= "<td>" . $consignacion . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Usuario que solicit&oacute;:</td>";
                $html .= "<td>" . $nombreSolicitante1 . "</td>";
                $html .= "<td>Estatus:</td>";
                $html .= "<td>" . $rsEstatusAudiencia . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Notas:</td>";
                $html .= "<td colspan='3'>" . utf8_encode($solicitudesAudienciasDto[0]->getObservaciones()) . "</td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE SOLICITUDES AUDIENCIAS////////////////////
//                $html .= "<table border='1' width='100%'>";
                $html .= "<table  class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='4' align='center'><b>DATOS DE LA SOLICITUD</b></td></tr>";
                $html .= "<tr>";
                $html .= "<td width='20%'>Estatus:</td>";
                $html .= "<td width='30%'>" . $rsEstatusSolicitudes . "</td>";
                $html .= "<td width='20%'>&#191;Detenido?</td>";
                $html .= "<td width='30%'>" . $consignacion . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Tipo de audiencia:</td>";
                $html .= "<td>" . $tiposAudiencia . "</td>";
                $html .= "<td>Tipo de naturaleza:</td>";
                $html .= "<td>" . $rsDesNaturaleza . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fase del proceso:</td>";
                $html .= "<td>" . $rsDesEtapaProcesal . "</td>";
                $html .= "<td>Usuario que solicit&oacute;:</td>";
                $html .= "<td>" . $nombreSolicitante1 . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fecha solicitud:</td>";
                $html .= "<td>" . $fechaFroamto . "</td>";
                $html .= "<td>Hora solicitud:</td>";
                $html .= "<td>" . $fecha[1] . "</td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE IMPUTADOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='2' align='center'><b>IMPUTADO(S)</b></td></tr>";
                $imputadosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $imputadosSolicitudesDto->setActivo("S");
                $imputadosSolicitudesDto = $imputadosSolicitudesDao->selectImputadossolicitudes($imputadosSolicitudesDto);
                if ($imputadosSolicitudesDto != "") {
                    foreach ($imputadosSolicitudesDto as $imputado) {
                        $html .= "<tr>";
                        $html .= "<td width='40%'>";
                        if ($imputado->getCveTipoPersona() == 1) {
                            $html .= "Nombre: " . utf8_encode($imputado->getNombre()) . " " . utf8_encode($imputado->getPaterno()) . " " . utf8_encode($imputado->getMaterno());
                        } else {
                            $html .= "Nombre: " . utf8_encode($imputado->getNombreMoral());
                        }

                        $html .= "</td>";
                        $html .= "<td width='60%'>";
                        ////////////////////////////////INGRESO AL CERESO
                        if ($imputado->getDetenido() == 'S') {
                            $html .= '&#191;Detenido?: Si <br>';
                            if ($imputado->getFechaControlDet() != "") {
                                $html .= 'Fecha de ingreso al cereso: ' . $this->fechaHoraNormal($imputado->getFechaControlDet()) . '<br>';
                            } else {
                                $html .= 'Fecha  de ingreso al cereso: N/A<br>';
                            }

                            if ($imputado->getCveCereso() != "") {
                                $ceresosDto->setCveCereso($imputado->getCveCereso());
                                $rsCeresosDto = $ceresosDao->selectCeresos($ceresosDto);
                                if ($rsCeresosDto != "") {
                                    $html .= 'Cereso: ' . utf8_decode($rsCeresosDto[0]->getDesCereso()) . '<br>';
                                } else {
                                    $html .= 'Ceresos: N/A<br>';
                                }
                            } else {
                                $html .= 'Ceresos: N/A<br>';
                            }
                        } else {
                            $html .= '&#191;Detenido?: No <br>';
                        }
                        ////////////////////////////////FIN INGRESO AL CERESO
                        $domiciliosimputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                        $domiciliosimputadosDto->setActivo("S");
                        $rsDomiciliosimputadosDto = $domiciliosimputadosDao->selectDomiciliosimputadossolicitudes($domiciliosimputadosDto);
                        if ($rsDomiciliosimputadosDto != "") {
                            foreach ($rsDomiciliosimputadosDto as $domicilioImputado) {
                                $html .= "Domicilio: " . utf8_encode($domicilioImputado->getDireccion());
                                if ($domicilioImputado->getNumExterior() != "") {
                                    $html .= " No. " . utf8_encode($domicilioImputado->getNumExterior());
                                }
                                if ($domicilioImputado->getColonia() != "") {
                                    $html .= " Colonia " . utf8_encode($domicilioImputado->getColonia());
                                }
                                if ($domicilioImputado->getCp() != "") {
                                    $html .= " C.P. " . ($domicilioImputado->getCp());
                                }
                                $html .= "<br>";
                            }
                        }
                        $defensoresImputadosDto->setActivo("S");
                        $defensoresImputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                        $rsDefensoresImputadosDto = $defensoresImputadosDao->selectDefensoresimputadossolicitudes($defensoresImputadosDto);
                        if ($rsDefensoresImputadosDto != "") {
                            foreach ($rsDefensoresImputadosDto as $defensorImputados) {
                                $html .= "Defensor: " . utf8_encode($defensorImputados->getNombre()) . "<br>";
                            }
                        }
                        $html .= "</td>";
                        $html .= "</tr>";
                    }
                }
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE OFENDIDOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='2' align='center'><b>SUJETO(S) PASIVO(S) DEL DELITO</b></td></tr>";
                $ofendidoSolicitudDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $ofendidoSolicitudDto->setActivo("S");
                $ofendidoSolicitudDto = $ofendidoSolicitudDao->selectOfendidossolicitudes($ofendidoSolicitudDto);
                if ($ofendidoSolicitudDto != "") {
                    foreach ($ofendidoSolicitudDto as $ofendido) {
                        $html .= "<tr>";
                        $html .= "<td width='40%'>";
                        if ($ofendido->getCveTipoParte() != "" && $ofendido->getCveTipoParte() != "0") {
                            $tipospartesDto->setCveTipoParte($ofendido->getCveTipoParte());
                            $rsTipospartesDto = $tipospartesDao->selectTipospartes($tipospartesDto);
                            if ($rsTipospartesDto != "") {
                                $tipo = $rsTipospartesDto[0]->getDescTipoParte();
                            } else {
                                $tipo = "OFENDIDO";
                            }
                        } else {
                            $tipo = "OFENDIDO";
                        }

                        if ($ofendido->getCveTipoPersona() == 1) {
                            $html .= "Nombre: " . utf8_encode($ofendido->getNombre()) . " " . utf8_encode($ofendido->getPaterno()) . " " . utf8_encode($ofendido->getMaterno()) . " <b>(" . utf8_encode($tipo) . ")</b>";
                        } else {
                            $html .= "Nombre: " . utf8_encode($ofendido->getNombreMoral()) . " <b>(" . utf8_encode($tipo) . ")</b>";
                        }

                        $html .= "</td>";
                        $html .= "<td width='60%'>";

                        $DomiciliosOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                        $DomiciliosOfendidosDto->setActivo("S");
                        $rsDomiciliosOfendidosDto = $DomiciliosOfendidosDao->selectDomiciliosofendidossolicitudes($DomiciliosOfendidosDto);
                        if ($rsDomiciliosOfendidosDto != "") {
                            foreach ($rsDomiciliosOfendidosDto as $domicilioOfendido) {
                                $html .= "Domicilio: " . ($domicilioOfendido->getDireccion());
                                if ($domicilioOfendido->getNumExterior() != "") {
                                    $html .= " No. " . ($domicilioOfendido->getNumExterior());
                                }
                                if ($domicilioOfendido->getColonia() != "") {
                                    $html .= " Colonia " . ($domicilioOfendido->getColonia());
                                }
                                if ($domicilioOfendido->getCp() != "") {
                                    $html .= " C.P. " . ($domicilioOfendido->getCp());
                                }
                                $html .= "<br>";
                            }
                        }
                        $defensoresOfendidosDto->setActivo("S");
                        $defensoresOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                        $rsDefensoresOfendidosDto = $defensoresOfendidosDao->selectDefensoresofendidossolicitudes($defensoresOfendidosDto);
                        if ($rsDefensoresOfendidosDto != "") {
                            foreach ($rsDefensoresOfendidosDto as $defensorImputados) {
                                $html .= "Defensor: " . ($defensorImputados->getNombre()) . "<br>";
                            }
                        }
                        $html .= "</td>";
                        $html .= "</tr>";
                    }
                }
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE DELITOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='4' align='center'><b>DELITO(S)</b></td></tr>";
                $html .= "<td>";
                $delitosSolicitudesDto->setActivo("S");
                $delitosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $rsDelitosSolicitudesDto = $delitosSolicitudesDao->selectDelitosInner($delitosSolicitudesDto);
                $index = 0;
                if ($rsDelitosSolicitudesDto != "") {
                    foreach ($rsDelitosSolicitudesDto as $delitoSolicitud) {
                        $index ++;
                        $html .= $index . ".- " . utf8_encode($delitoSolicitud->getDesDelito()) . "<br>";
                    }
                }
                $html .= "</td>";
                $html .= "</table><br>";
                $html .= "<script language=\"javascript\">";
                $html .= "window.print();";
                $html .= "</script>";
            } else {
                $html .= "La solicitud no se encuentra enviada.";
            }
        } else {
            $html .= "No se encontro la solicitud audiencia.";
        }

        return $html;
    }

    public function consultaAcuseAudiencia($param) {
        $idAudiencia = $param["idSolicitudAudiencaGet"];
        $html = "";
        $audienciasDto = new AudienciasDTO();
        $audienciasDao = new AudienciasDAO();
        $audienciasDto->setIdAudiencia($idAudiencia);
        $audienciasDto = $audienciasDao->selectAudiencias($audienciasDto);
        if ($audienciasDto != "") {
            $solicitudesAudienciasDto = new SolicitudesaudienciasDTO();
            $solicitudesAudienciasDao = new SolicitudesaudienciasDAO();

            $solicitudesAudienciasDto->setIdSolicitudAudiencia($audienciasDto[0]->getIdSolicitudAudiencia());
            $solicitudesAudienciasDto = $solicitudesAudienciasDao->selectSolicitudesaudiencias($solicitudesAudienciasDto);

            if ($solicitudesAudienciasDto != "") {
                $idSolicitudAudiencia = $solicitudesAudienciasDto[0]->getIdSolicitudAudiencia();


                $usuarioWS = new UsuarioCliente();

                $imputadosSolicitudesDto = new ImputadossolicitudesDTO();
                $imputadosSolicitudesDao = new ImputadossolicitudesDAO();

                $ofendidoSolicitudDao = new OfendidossolicitudesDAO();
                $ofendidoSolicitudDto = new OfendidossolicitudesDTO();

                $domiciliosimputadosDto = new DomiciliosimputadossolicitudesDTO();
                $domiciliosimputadosDao = new DomiciliosimputadossolicitudesDAO();

                $DomiciliosOfendidosDto = new DomiciliosofendidossolicitudesDTO();
                $DomiciliosOfendidosDao = new DomiciliosofendidossolicitudesDAO();

                $defensoresImputadosDto = new DefensoresimputadossolicitudesDTO();
                $defensoresImputadosDao = new DefensoresimputadossolicitudesDAO();

                $defensoresOfendidosDto = new DefensoresofendidossolicitudesDTO();
                $defensoresOfendidosDao = new DefensoresofendidossolicitudesDAO();

                $delitosSolicitudesDto = new DelitossolicitudesDTO();
                $delitosSolicitudesDao = new DelitossolicitudesDAO();

                $tipospartesDto = new TipospartesDTO();
                $tipospartesDao = new TipospartesDAO();

                $ceresosDto = new CeresosDTO();
                $ceresosDao = new CeresosDAO();
                ////////////////////////////////////////////////////////////////
                //
                //
                //
                //
                //
                //
                ////////////////////////////Se define el tipo de carpeta
                if ($audienciasDto[0]->getCveTipoCarpeta() != "" && $audienciasDto[0]->getCveTipoCarpeta() != 0) {
                    if ($audienciasDto[0]->getCveTipoCarpeta() == 1) {
                        $numAuxiliar = $audienciasDto[0]->getNumero() . "/" . $audienciasDto[0]->getAnio();
                        $numCausa = "N/A";
                    } else {
                        $numCausa = $audienciasDto[0]->getNumero() . "/" . $audienciasDto[0]->getAnio();
                        $numAuxiliar = "N/A";
                    }
                } else {
                    $numAuxiliar = "N/A";
                    $numCausa = "N/A";
                }


                //Descripci�n de la sala
                $salasDto = new SalasDTO();
                $salasDao = new SalasDAO();
                $salasDto->setCveSala($audienciasDto[0]->getCveSala());
                $salasDto = $salasDao->selectSalas($salasDto);

                if ($salasDto != "") {
                    $rsDesSala = utf8_encode($salasDto[0]->getDesSala());
                } else {
                    $rsDesSala = "N/A";
                }

                ////////////////////////////traer la descripcion de la solicitud
                $catAudiencasDto = new CataudienciasDTO();
                $catAudiencasDao = new CataudienciasDAO();

                $catAudiencasDto->setCveCatAudiencia($audienciasDto[0]->getCveCatAudiencia());
                $rsCatAudienciasDto = $catAudiencasDao->selectCataudiencias($catAudiencasDto);
                if ($rsCatAudienciasDto != "") {
                    $rsDesAudiencia = utf8_encode($rsCatAudienciasDto[0]->getDesCatAudiencia());
                } else {
                    $rsDesAudiencia = "N/A";
                }

                ///////////////////////////Traer la descripcion de la naturaleza
                $naturalezasDto = new NaturalezasDTO();
                $naturalezasDao = new NaturalezasDAO();
                $naturalezasDto->setCveNaturaleza($solicitudesAudienciasDto[0]->getCveNaturaleza());
                $rsNaturalezasDto = $naturalezasDao->selectNaturalezas($naturalezasDto);
                if ($rsNaturalezasDto != "") {
                    $rsDesNaturaleza = utf8_encode($rsNaturalezasDto[0]->getDesNaturaleza());
                } else {
                    $rsDesNaturaleza = "N/A";
                }
                ////definir la consignacion
                if ($solicitudesAudienciasDto[0]->getCveConsignacion() == 1 || $solicitudesAudienciasDto[0]->getCveConsignacion() == 3) {
                    $consignacion = "S";
                } else {
                    $consignacion = "N";
                }
                /////////////////////////////////////Descripcion de la audiencia
                $estatusAudienciasDto = new EstatusaudienciasDTO();
                $estatusAudienciasDao = new EstatusaudienciasDAO();
                $estatusAudienciasDto->setCveEstatusAudiencia($audienciasDto[0]->getCveEstatusAudiencia());
                $rsEstatusAudienciasDto = $estatusAudienciasDao->selectEstatusaudiencias($estatusAudienciasDto);
                if ($rsEstatusAudienciasDto != "") {
                    $rsEstatusAudiencia = utf8_encode($rsEstatusAudienciasDto[0]->getDesEstatusAudiencia());
                } else {
                    $rsEstatusAudiencia = "N/A";
                }

                /////////////////////////////////////Descripcion del estatus de la solicitud
                $estatusSolicitudesDto = new EstatussolicitudesDTO();
                $estatusSolicitudesDao = new EstatussolicitudesDAO();
                $estatusSolicitudesDto->setCveEstatusSolicitud($solicitudesAudienciasDto[0]->getCveEstatusSolicitud());
                $rsEstatusSolicitudesDto = $estatusSolicitudesDao->selectEstatussolicitudes($estatusSolicitudesDto);
                if ($rsEstatusSolicitudesDto != "") {
                    $rsEstatusSolicitudes = utf8_encode($rsEstatusSolicitudesDto[0]->getDesEstatusSolicitud());
                } else {
                    $rsEstatusSolicitudes = "N/A";
                }

                ////////////////////////////////Descripcion del tipo de audiencia
                $tiposAudienciasDto = new TiposaudienciasDTO();
                $tiposAudienciasDao = new TiposaudienciasDAO();

                $tiposAudienciasDto->setCveTipoAudiencia($solicitudesAudienciasDto[0]->getCveTipoAudiencia());
                $rsTiposAudienciasDto = $tiposAudienciasDao->selectTiposaudiencias($tiposAudienciasDto);
                if ($rsTiposAudienciasDto != "") {
                    $tiposAudiencia = utf8_encode($rsTiposAudienciasDto[0]->getDesTipoAudiencia());
                } else {
                    $tiposAudiencia = "N/A";
                }

                //////////////////////////////////////////////////Etapa procesal
                $etapaProcesalDto = new EtapasprocesalesDTO();
                $etapaProcesalDao = new EtapasprocesalesDAO();
                $etapaProcesalDto->setCveEtapaProcesal($solicitudesAudienciasDto[0]->getCveEtapaProcesal());
                $rsEtapaProcesalDto = $etapaProcesalDao->selectEtapasprocesales($etapaProcesalDto);
                if ($rsEtapaProcesalDto != "") {
                    $rsDesEtapaProcesal = utf8_encode($rsEtapaProcesalDto[0]->getDesEtapaProcesal());
                } else {
                    $rsDesEtapaProcesal = "N/A";
                }
                //////fecha y hora de la solicitud
                $fecha = explode(" ", $solicitudesAudienciasDto[0]->getFechaRegistro());
                $fechaFroamto = $this->fechaNormal($fecha[0]);
                ////Nombre de los solicitantes
                $usuario = $usuarioWS->getUsuarios($solicitudesAudienciasDto[0]->getCveUsuario());
                $usuario = json_decode($usuario, true);
                if ($usuario != "") {
                    $nombreSolicitante = utf8_encode($usuario["data"][0]["nombre"] . " " . $usuario["data"][0]["paterno"] . " " . $usuario["data"][0]["materno"]);
                } else {
                    $nombreSolicitante = "N/A";
                }
                $usuario1 = $usuarioWS->getUsuarios($audienciasDto[0]->getCveUsuario());
                $usuario1 = json_decode($usuario1, true);
                if ($usuario1 != "") {
                    $nombreSolicitante1 = utf8_encode($usuario["data"][0]["nombre"] . " " . $usuario["data"][0]["paterno"] . " " . $usuario["data"][0]["materno"]);
                } else {
                    $nombreSolicitante1 = "N/A";
                }


                $html .= "<style type='text/css'>";
                $html .= ".tablaPrint{";
                $html .= "font-family: Arial;";
                $html .= "font-size: 12px;";
                $html .= "border: 1px solid #000;";
                $html .= "border-collapse: collapse;";
                $html .= "}";
                $html .= "</style>";

                ///////////////////////////////////////Logos////////////////////
                $html .= "<table border='0' width='100%' >";
                $html .= "<tr>";
                $html .= "<td><img src='../../../vistas/img/logoPj.png'></td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE AUDIENCIAS////////////////////
                $html .= " <table class='tablaPrint' border='1' width='100%' >";
                $html .= "<tr><td colspan='4' align='center'><b>DATOS DE LA AUDIENCIA<b></td></tr>";
                $html .= "<tr>";
                if ($audienciasDto[0]->getCveTipoCarpeta() == '6') {
                    $html .= "<td width='20%'>Toca:</td>";
                } else {
                    $html .= "<td width='20%'>Causa:</td>";
                }
                $html .= "<td width='30%'>" . $numCausa . "</td>";
                $html .= "<td width='20%'>Num Auxiliar:</td>";
                $html .= "<td width='30%'>" . $numAuxiliar . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Audiencia:</td>";
                $html .= "<td colspan='3'>" . $rsDesAudiencia . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fecha audiencia:</td>";
                $html .= "<td>" . $this->fechaHoraNormal($audienciasDto[0]->getFechaInicial()) . "</td>";
                $html .= "<td>Fecha final</td>";
                $html .= "<td>" . $this->fechaHoraNormal($audienciasDto[0]->getFechaFinal()) . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Sala:</td>";
                $html .= "<td colspan='3'>" . $rsDesSala . "</td>";
                $html .= "</tr>";
//                $html .= "<tr>";
//                $html .= "<td>Juez:</td>";
//
//                $audienciasJuzgadorDao = new AudienciasjuzgadorDAO();
//                $audienciasJuzgadorDto = new AudienciasjuzgadorDTO();
//                $audienciasJuzgadorDto->setIdAudiencia($audienciasDto[0]->getIdAudiencia());
//                $audienciasJuzgadorDto->setActivo("S");
//                $selectAudienciasJuzgadores = $audienciasJuzgadorDao->selectAudienciasjuzgador($audienciasJuzgadorDto);
//                $juez = "";
//                if ($selectAudienciasJuzgadores != "") {
//                    $juzgadoresDto = new JuzgadoresDTO();
//                    $juzgadoresDao = new JuzgadoresDAO();
//
//
//                    foreach ($selectAudienciasJuzgadores as $audienciasJuzgador) {
//                        $juzgadoresDto->setIdJuzgador($audienciasJuzgador->getIdJuzgador());
//                        $rsJuzgadoresDto = $juzgadoresDao->selectJuzgadores($juzgadoresDto);
//                        if ($rsJuzgadoresDto != "") {
//                            $juez .= utf8_encode($rsJuzgadoresDto[0]->getNombre()) . " " . utf8_encode($rsJuzgadoresDto[0]->getPaterno()) . " " . utf8_encode($rsJuzgadoresDto[0]->getMaterno()) . "<br>";
//                        } else {
//                            $juez .= "N/A";
//                        }
//                    }
//                } else {
//                    $juez .= "N/A";
//                }
//                $html .= "<td colspan='3'>" . $juez . "</td>";
//                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Carpeta Inv:</td>";
                if ($solicitudesAudienciasDto[0]->getCarpetaInv() != "") {
                    $html .= "<td>" . $solicitudesAudienciasDto[0]->getCarpetaInv() . "</td>";
                } else {
                    $html .= "<td>N/A</td>";
                }
                $html .= "<td>NUC:</td>";
                if ($solicitudesAudienciasDto[0]->getNuc() != "") {
                    $html .= "<td>" . $solicitudesAudienciasDto[0]->getNuc() . "</td>";
                } else {
                    $html .= "<td>N/A</td>";
                }
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Naturaleza:</td>";
                $html .= "<td>" . $rsDesNaturaleza . "</td>";
                $html .= "<td>&#191;Detenido?</td>";

                $html .= "<td>" . $consignacion . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Usuario que solicit&oacute;:</td>";
                $html .= "<td>" . $nombreSolicitante1 . "</td>";
                $html .= "<td>Estatus:</td>";
                $html .= "<td>" . $rsEstatusAudiencia . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Notas:</td>";
                $html .= "<td colspan='3'>" . utf8_encode($solicitudesAudienciasDto[0]->getObservaciones()) . "</td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE SOLICITUDES AUDIENCIAS////////////////////
//                $html .= "<table border='1' width='100%'>";
                $html .= "<table  class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='4' align='center'><b>DATOS DE LA SOLICITUD</b></td></tr>";
                $html .= "<tr>";
                $html .= "<td width='20%'>Estatus:</td>";
                $html .= "<td width='30%'>" . $rsEstatusSolicitudes . "</td>";
                $html .= "<td width='20%'>&#191;Detenido?</td>";
                $html .= "<td width='30%'>" . $consignacion . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Tipo de audiencia:</td>";
                $html .= "<td>" . $tiposAudiencia . "</td>";
                $html .= "<td>Tipo de naturaleza:</td>";
                $html .= "<td>" . $rsDesNaturaleza . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fase del proceso:</td>";
                $html .= "<td>" . $rsDesEtapaProcesal . "</td>";
                $html .= "<td>Usuario que solicit&oacute;:</td>";
                $html .= "<td>" . $nombreSolicitante1 . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fecha solicitud:</td>";
                $html .= "<td>" . $fechaFroamto . "</td>";
                $html .= "<td>Hora solicitud:</td>";
                $html .= "<td>" . $fecha[1] . "</td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE IMPUTADOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='2' align='center'><b>IMPUTADO(S)</b></td></tr>";


                $imputadosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $imputadosSolicitudesDto->setActivo("S");
                $imputadosSolicitudesDto = $imputadosSolicitudesDao->selectImputadossolicitudes($imputadosSolicitudesDto);
                if ($imputadosSolicitudesDto != "") {
                    foreach ($imputadosSolicitudesDto as $imputado) {
                        $html .= "<tr>";
                        $html .= "<td width='40%'>";
                        if ($imputado->getCveTipoPersona() == 1) {
                            $html .= "Nombre: " . utf8_encode($imputado->getNombre()) . " " . utf8_encode($imputado->getPaterno()) . " " . utf8_encode($imputado->getMaterno());
                        } else {
                            $html .= "Nombre: " . utf8_encode($imputado->getNombreMoral());
                        }

                        $html .= "</td>";

                        $html .= "<td width='60%'>";
                        ////////////////////////////////INGRESO AL CERESO
                        if ($imputado->getDetenido() == 'S') {
                            $html .= '&#191;Detenido?: Si <br>';
                            if ($imputado->getFechaControlDet() != "") {
                                $html .= 'Fecha de ingreso al cereso: ' . $this->fechaHoraNormal($imputado->getFechaControlDet()) . '<br>';
                            } else {
                                $html .= 'Fecha de ingreso al cereso: N/A<br>';
                            }

                            if ($imputado->getCveCereso() != "") {
                                $ceresosDto->setCveCereso($imputado->getCveCereso());
                                $rsCeresosDto = $ceresosDao->selectCeresos($ceresosDto);
                                if ($rsCeresosDto != "") {
                                    $html .= 'Cereso: ' . utf8_decode($rsCeresosDto[0]->getDesCereso()) . '<br>';
                                } else {
                                    $html .= 'Ceresos: N/A<br>';
                                }
                            } else {
                                $html .= 'Ceresos: N/A<br>';
                            }
                        } else {
                            $html .= '&#191;Detenido?: No <br>';
                        }
                        ////////////////////////////////FIN INGRESO AL CERESO
                        $domiciliosimputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                        $domiciliosimputadosDto->setActivo("S");
                        $rsDomiciliosimputadosDto = $domiciliosimputadosDao->selectDomiciliosimputadossolicitudes($domiciliosimputadosDto);
                        if ($rsDomiciliosimputadosDto != "") {
                            foreach ($rsDomiciliosimputadosDto as $domicilioImputado) {
                                $html .= "Domicilio: " . utf8_encode($domicilioImputado->getDireccion());
                                if ($domicilioImputado->getNumExterior() != "") {
                                    $html .= " No. " . utf8_encode($domicilioImputado->getNumExterior());
                                }
                                if ($domicilioImputado->getColonia() != "") {
                                    $html .= " Colonia " . utf8_encode($domicilioImputado->getColonia());
                                }
                                if ($domicilioImputado->getCp() != "") {
                                    $html .= " C.P. " . ($domicilioImputado->getCp());
                                }
                                $html .= "<br>";
                            }
                        }
                        $defensoresImputadosDto->setActivo("S");
                        $defensoresImputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                        $rsDefensoresImputadosDto = $defensoresImputadosDao->selectDefensoresimputadossolicitudes($defensoresImputadosDto);
                        if ($rsDefensoresImputadosDto != "") {
                            foreach ($rsDefensoresImputadosDto as $defensorImputados) {
                                $html .= "Defensor: " . utf8_encode($defensorImputados->getNombre()) . "<br>";
                            }
                        }
                        $html .= "</td>";
                        $html .= "</tr>";
                    }
                }
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE OFENDIDOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='2' align='center'><b>SUJETO(S) PASIVO(S) DEL DELITO</b></td></tr>";
                $ofendidoSolicitudDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $ofendidoSolicitudDto->setActivo("S");
                $ofendidoSolicitudDto = $ofendidoSolicitudDao->selectOfendidossolicitudes($ofendidoSolicitudDto);
                if ($ofendidoSolicitudDto != "") {
                    foreach ($ofendidoSolicitudDto as $ofendido) {
                        $html .= "<tr>";
                        $html .= "<td width='40%'>";
                        if ($ofendido->getCveTipoParte() != "" && $ofendido->getCveTipoParte() != "0") {

                            $tipospartesDto->setCveTipoParte($ofendido->getCveTipoParte());
                            $rsTipospartesDto = $tipospartesDao->selectTipospartes($tipospartesDto);
                            if ($rsTipospartesDto != "") {
                                $tipo = $rsTipospartesDto[0]->getDescTipoParte();
                            } else {
                                $tipo = "OFENDIDO";
                            }
                        } else {
                            $tipo = "OFENDIDO";
                        }

                        if ($ofendido->getCveTipoPersona() == 1) {
                            $html .= "Nombre: " . utf8_encode($ofendido->getNombre()) . " " . utf8_encode($ofendido->getPaterno()) . " " . utf8_encode($ofendido->getMaterno()) . " <b>(" . utf8_encode($tipo) . ")</b>";
                        } else {
                            $html .= "Nombre: " . utf8_encode($ofendido->getNombreMoral()) . " <b>(" . utf8_encode($tipo) . ")</b>";
                        }


                        $html .= "</td>";
                        $html .= "<td width='60%'>";

                        $DomiciliosOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                        $DomiciliosOfendidosDto->setActivo("S");
                        $rsDomiciliosOfendidosDto = $DomiciliosOfendidosDao->selectDomiciliosofendidossolicitudes($DomiciliosOfendidosDto);
                        if ($rsDomiciliosOfendidosDto != "") {
                            foreach ($rsDomiciliosOfendidosDto as $domicilioOfendido) {
                                $html .= "Domicilio: " . ($domicilioOfendido->getDireccion());
                                if ($domicilioOfendido->getNumExterior() != "") {
                                    $html .= " No. " . ($domicilioOfendido->getNumExterior());
                                }
                                if ($domicilioOfendido->getColonia() != "") {
                                    $html .= " Colonia " . ($domicilioOfendido->getColonia());
                                }
                                if ($domicilioOfendido->getCp() != "") {
                                    $html .= " C.P. " . ($domicilioOfendido->getCp());
                                }
                                $html .= "<br>";
                            }
                        }
                        $defensoresOfendidosDto->setActivo("S");
                        $defensoresOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                        $rsDefensoresOfendidosDto = $defensoresOfendidosDao->selectDefensoresofendidossolicitudes($defensoresOfendidosDto);
                        if ($rsDefensoresOfendidosDto != "") {
                            foreach ($rsDefensoresOfendidosDto as $defensorImputados) {
                                $html .= "Defensor: " . ($defensorImputados->getNombre()) . "<br>";
                            }
                        }
                        $html .= "</td>";
                        $html .= "</tr>";
                    }
                }
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE DELITOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='4' align='center'><b>DELITO(S)</b></td></tr>";
                $html .= "<td>";
                $delitosSolicitudesDto->setActivo("S");
                $delitosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $rsDelitosSolicitudesDto = $delitosSolicitudesDao->selectDelitosInner($delitosSolicitudesDto);
                $index = 0;
                if ($rsDelitosSolicitudesDto != "") {
                    foreach ($rsDelitosSolicitudesDto as $delitoSolicitud) {
                        $index ++;
                        $html .= $index . ".- " . utf8_encode($delitoSolicitud->getDesDelito()) . "<br>";
                    }
                }
                $html .= "</td>";
                $html .= "</table><br>";
                $html .= "<script language=\"javascript\">";
                $html .= "window.print();";
                $html .= "</script>";
            } else {
                $html .= "No se encontro la solicitud audiencia.";
            }
        } else {
            $html .= "La solicitud no se encuentra enviada.";
        }

        return $html;
    }

    public function consultaAcuseAuto($param) {
        $idSolicitudAudiencia = $param["idSolicitudAudiencaGet"];
        $html = "";
        $solicitudesAudienciasDto = new SolicitudesaudienciasDTO();
        $solicitudesAudienciasDao = new SolicitudesaudienciasDAO();

        $solicitudesAudienciasDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
        $solicitudesAudienciasDto = $solicitudesAudienciasDao->selectSolicitudesaudiencias($solicitudesAudienciasDto);

        if ($solicitudesAudienciasDto != "") {
            $audienciasDto = new AudienciasDTO();
            $audienciasDao = new AudienciasDAO();
            $audienciasDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
            $audienciasDto = $audienciasDao->selectAudiencias($audienciasDto);
            if ($audienciasDto != "") {
                $usuarioWS = new UsuarioCliente();

                $imputadosSolicitudesDto = new ImputadossolicitudesDTO();
                $imputadosSolicitudesDao = new ImputadossolicitudesDAO();

                $ofendidoSolicitudDao = new OfendidossolicitudesDAO();
                $ofendidoSolicitudDto = new OfendidossolicitudesDTO();

                $domiciliosimputadosDto = new DomiciliosimputadossolicitudesDTO();
                $domiciliosimputadosDao = new DomiciliosimputadossolicitudesDAO();

                $DomiciliosOfendidosDto = new DomiciliosofendidossolicitudesDTO();
                $DomiciliosOfendidosDao = new DomiciliosofendidossolicitudesDAO();

                $defensoresImputadosDto = new DefensoresimputadossolicitudesDTO();
                $defensoresImputadosDao = new DefensoresimputadossolicitudesDAO();

                $defensoresOfendidosDto = new DefensoresofendidossolicitudesDTO();
                $defensoresOfendidosDao = new DefensoresofendidossolicitudesDAO();

                $delitosSolicitudesDto = new DelitossolicitudesDTO();
                $delitosSolicitudesDao = new DelitossolicitudesDAO();


                $tipospartesDto = new TipospartesDTO();
                $tipospartesDao = new TipospartesDAO();

                $ceresosDto = new CeresosDTO();
                $ceresosDao = new CeresosDAO();
                ////////////////////////////////////////////////////////////////
                //
                //
                //
                //
                //
                //
                ////////////////////////////Se define el tipo de carpeta
                if ($audienciasDto[0]->getCveTipoCarpeta() != "" && $audienciasDto[0]->getCveTipoCarpeta() != 0) {
                    if ($audienciasDto[0]->getCveTipoCarpeta() == 1) {
                        $numAuxiliar = $audienciasDto[0]->getNumero() . "/" . $audienciasDto[0]->getAnio();
                        $numCausa = "N/A";
                    } else {
                        $numCausa = $audienciasDto[0]->getNumero() . "/" . $audienciasDto[0]->getAnio();
                        $numAuxiliar = "N/A";
                    }
                } else {
                    $numAuxiliar = "N/A";
                    $numCausa = "N/A";
                }



                //Descripci�n de la sala
                $salasDto = new SalasDTO();
                $salasDao = new SalasDAO();
                $salasDto->setCveSala($audienciasDto[0]->getCveSala());
                $salasDto = $salasDao->selectSalas($salasDto);

                if ($salasDto != "") {
                    $rsDesSala = utf8_encode($salasDto[0]->getDesSala());
                } else {
                    $rsDesSala = "N/A";
                }

                ////////////////////////////traer la descripcion de la solicitud
                $catAudiencasDto = new CataudienciasDTO();
                $catAudiencasDao = new CataudienciasDAO();

                $catAudiencasDto->setCveCatAudiencia($audienciasDto[0]->getCveCatAudiencia());
                $rsCatAudienciasDto = $catAudiencasDao->selectCataudiencias($catAudiencasDto);
                if ($rsCatAudienciasDto != "") {
                    $rsDesAudiencia = utf8_encode($rsCatAudienciasDto[0]->getDesCatAudiencia());
                } else {
                    $rsDesAudiencia = "N/A";
                }

                ///////////////////////////Traer la descripcion de la naturaleza
                $naturalezasDto = new NaturalezasDTO();
                $naturalezasDao = new NaturalezasDAO();
                $naturalezasDto->setCveNaturaleza($solicitudesAudienciasDto[0]->getCveNaturaleza());
                $rsNaturalezasDto = $naturalezasDao->selectNaturalezas($naturalezasDto);
                if ($rsNaturalezasDto != "") {
                    $rsDesNaturaleza = utf8_encode($rsNaturalezasDto[0]->getDesNaturaleza());
                } else {
                    $rsDesNaturaleza = "N/A";
                }
                ////definir la consignacion
                if ($solicitudesAudienciasDto[0]->getCveConsignacion() == 1 || $solicitudesAudienciasDto[0]->getCveConsignacion() == 3) {
                    $consignacion = "S";
                } else {
                    $consignacion = "N";
                }
                /////////////////////////////////////Descripcion de la audiencia
                $estatusAudienciasDto = new EstatusaudienciasDTO();
                $estatusAudienciasDao = new EstatusaudienciasDAO();
                $estatusAudienciasDto->setCveEstatusAudiencia($audienciasDto[0]->getCveEstatusAudiencia());
                $rsEstatusAudienciasDto = $estatusAudienciasDao->selectEstatusaudiencias($estatusAudienciasDto);
                if ($rsEstatusAudienciasDto != "") {
                    $rsEstatusAudiencia = utf8_encode($rsEstatusAudienciasDto[0]->getDesEstatusAudiencia());
                } else {
                    $rsEstatusAudiencia = "N/A";
                }

                /////////////////////////////////////Descripcion del estatus de la solicitud
                $estatusSolicitudesDto = new EstatussolicitudesDTO();
                $estatusSolicitudesDao = new EstatussolicitudesDAO();
                $estatusSolicitudesDto->setCveEstatusSolicitud($solicitudesAudienciasDto[0]->getCveEstatusSolicitud());
                $rsEstatusSolicitudesDto = $estatusSolicitudesDao->selectEstatussolicitudes($estatusSolicitudesDto);
                if ($rsEstatusSolicitudesDto != "") {
                    $rsEstatusSolicitudes = utf8_encode($rsEstatusSolicitudesDto[0]->getDesEstatusSolicitud());
                } else {
                    $rsEstatusSolicitudes = "N/A";
                }

                ////////////////////////////////Descripcion del tipo de audiencia
                $tiposAudienciasDto = new TiposaudienciasDTO();
                $tiposAudienciasDao = new TiposaudienciasDAO();

                $tiposAudienciasDto->setCveTipoAudiencia($solicitudesAudienciasDto[0]->getCveTipoAudiencia());
                $rsTiposAudienciasDto = $tiposAudienciasDao->selectTiposaudiencias($tiposAudienciasDto);
                if ($rsTiposAudienciasDto != "") {
                    $tiposAudiencia = utf8_encode($rsTiposAudienciasDto[0]->getDesTipoAudiencia());
                } else {
                    $tiposAudiencia = "N/A";
                }

                //////////////////////////////////////////////////Etapa procesal
                $etapaProcesalDto = new EtapasprocesalesDTO();
                $etapaProcesalDao = new EtapasprocesalesDAO();
                $etapaProcesalDto->setCveEtapaProcesal($solicitudesAudienciasDto[0]->getCveEtapaProcesal());
                $rsEtapaProcesalDto = $etapaProcesalDao->selectEtapasprocesales($etapaProcesalDto);
                if ($rsEtapaProcesalDto != "") {
                    $rsDesEtapaProcesal = utf8_encode($rsEtapaProcesalDto[0]->getDesEtapaProcesal());
                } else {
                    $rsDesEtapaProcesal = "N/A";
                }
                //////fecha y hora de la solicitud
                $fecha = explode(" ", $solicitudesAudienciasDto[0]->getFechaRegistro());
                $fechaFroamto = $this->fechaNormal($fecha[0]);
                ////Nombre de los solicitantes
                $usuario = $usuarioWS->getUsuarios($solicitudesAudienciasDto[0]->getCveUsuario());
                $usuario = json_decode($usuario, true);
                if ($usuario != "") {
                    $nombreSolicitante = utf8_encode($usuario["data"][0]["nombre"] . " " . $usuario["data"][0]["paterno"] . " " . $usuario["data"][0]["materno"]);
                } else {
                    $nombreSolicitante = "N/A";
                }
                $usuario1 = $usuarioWS->getUsuarios($audienciasDto[0]->getCveUsuario());
                $usuario1 = json_decode($usuario1, true);
                if ($usuario1 != "") {
                    $nombreSolicitante1 = utf8_encode($usuario["data"][0]["nombre"] . " " . $usuario["data"][0]["paterno"] . " " . $usuario["data"][0]["materno"]);
                } else {
                    $nombreSolicitante1 = "N/A";
                }


                $html .= "<style type='text/css'>";
                $html .= ".tablaPrint{";
                $html .= "font-family: Arial;";
                $html .= "font-size: 12px;";
                $html .= "border: 1px solid #000;";
                $html .= "border-collapse: collapse;";
                $html .= "}";
                $html .= "</style>";

                ///////////////////////////////////////Logos////////////////////
                $html .= "<table border='0' width='100%' >";
                $html .= "<tr>";
                $html .= "<td><img src='../../../vistas/img/logoPj.png'></td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE AUDIENCIAS////////////////////
                $html .= " <table class='tablaPrint' border='1' width='100%' >";
                $html .= "<tr><td colspan='4' align='center'><b>DATOS DE LA AUDIENCIA<b></td></tr>";
                $html .= "<tr>";
                if ($audienciasDto[0]->getCveTipoCarpeta() == '6') {
                    $html .= "<td width='20%'>Toca:</td>";
                } else {
                    $html .= "<td width='20%'>Causa:</td>";
                }

                $html .= "<td width='30%'>" . $numCausa . "</td>";
                $html .= "<td width='20%'>Num Auxiliar:</td>";
                $html .= "<td width='30%'>" . $numAuxiliar . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Audiencia:</td>";
                $html .= "<td colspan='3'>" . $rsDesAudiencia . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fecha audiencia:</td>";
                $html .= "<td>" . $this->fechaHoraNormal($audienciasDto[0]->getFechaInicial()) . "</td>";
                $html .= "<td>Fecha final</td>";
                $html .= "<td>" . $this->fechaHoraNormal($audienciasDto[0]->getFechaFinal()) . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Sala:</td>";

                if (isset($param['toca']) && $param['toca'] == 'S') {

                    $salasDao = new SalasDAO();
                    $salasDto = new SalasDto();

                    $salasDto->setCveSala($audienciasDto[0]->getCveSala());

                    $selectSalas = $salasDao->selectSalas($salasDto);

                    $desSala = 'POR DEFINIR';
                    if ($selectSalas != '') {
                        $desSala = $selectSalas[0]->getDesSala();
                    }

                    $html .= "<td colspan='3'>" . $desSala . "</td>";
                } else {
                    $html .= "<td colspan='3'>" . $rsDesSala . "</td>";
                }

                $html .= "</tr>";

                if (isset($param['toca']) && $param['toca'] == 'S') {

                    $html .= "<tr>";

                    if (isset($param['leyendajuez']) && $param['leyendajuez'] != '') {
                        $html .= "<td>" . $param['leyendajuez'] . "</td>";
                    } else {
                        $html .= "<td>Magistrado(s):</td>";
                    }


                    $magistrados = "";

                    $audienciasJuzgadorDao = new AudienciasjuzgadorDAO();
                    $audienciasJuzgadorDto = new AudienciasjuzgadorDTO();

                    $audienciasJuzgadorDto->setIdAudiencia($audienciasDto[0]->getIdAudiencia());

                    $selectAudienciasJuzgadores = $audienciasJuzgadorDao->selectAudienciasjuzgador($audienciasJuzgadorDto);

                    if ($selectAudienciasJuzgadores != '') {

                        foreach ($selectAudienciasJuzgadores as $audienciaJuzgador) {


                            $funcionesJuzgadoresDao = new FuncionesjuzgadoresDAO();
                            $funcionesJuzgadoresDto = new FuncionesjuzgadoresDTO();

                            $funcionesJuzgadoresDto->setCveFuncionJuzgador($audienciaJuzgador->getCveFuncionJuzgador());

                            $selectFuncionJuzgador = $funcionesJuzgadoresDao->selectFuncionesjuzgadores($funcionesJuzgadoresDto);

                            $funcion = '';
                            $nombre = '';

                            if ($selectFuncionJuzgador != '') {
                                $funcion = $selectFuncionJuzgador[0]->getDesFuncionJuzgador();
                            }

                            $juzgadoresDao = new JuzgadoresDAO();
                            $juzgadoresDto = new JuzgadoresDTO();

                            $juzgadoresDto->setIdJuzgador($audienciaJuzgador->getIdJuzgador());

                            $selectJuzgadores = $juzgadoresDao->selectJuzgadores($juzgadoresDto);

                            if ($selectJuzgadores != '') {
                                $nombre = $selectJuzgadores[0]->getNombre() . ' ' . $selectJuzgadores[0]->getPaterno() . ' ' . $selectJuzgadores[0]->getMaterno();
                            }


                            $magistrados .= $funcion . ': ' . $nombre . '<br>';
                        }
                    }

                    $html .= "<td colspan='3'>" . $magistrados . "</td>";

                    $html .= "</tr>";
                } else {
                    $html .= "<tr>";
                    $html .= "<td>Juez:</td>";

                    $audienciasJuzgadorDao = new AudienciasjuzgadorDAO();
                    $audienciasJuzgadorDto = new AudienciasjuzgadorDTO();
                    $audienciasJuzgadorDto->setIdAudiencia($audienciasDto[0]->getIdAudiencia());
                    $audienciasJuzgadorDto->setActivo("S");
                    $selectAudienciasJuzgadores = $audienciasJuzgadorDao->selectAudienciasjuzgador($audienciasJuzgadorDto);
                    $juez = "";
                    if ($selectAudienciasJuzgadores != "") {
                        $juzgadoresDto = new JuzgadoresDTO();
                        $juzgadoresDao = new JuzgadoresDAO();


                        foreach ($selectAudienciasJuzgadores as $audienciasJuzgador) {
                            $juzgadoresDto->setIdJuzgador($audienciasJuzgador->getIdJuzgador());
                            $rsJuzgadoresDto = $juzgadoresDao->selectJuzgadores($juzgadoresDto);
                            if ($rsJuzgadoresDto != "") {
                                $juez .= utf8_encode($rsJuzgadoresDto[0]->getNombre()) . " " . utf8_encode($rsJuzgadoresDto[0]->getPaterno()) . " " . utf8_encode($rsJuzgadoresDto[0]->getMaterno()) . "<br>";
                            } else {
                                $juez .= "N/A";
                            }
                        }
                    } else {
                        $juez .= "N/A";
                    }
                    $html .= "<td colspan='3'>" . $juez . "</td>";
                    $html .= "</tr>";
                }

                $html .= "<tr>";
                $html .= "<td>Carpeta Inv:</td>";
                if ($solicitudesAudienciasDto[0]->getCarpetaInv() != "") {
                    $html .= "<td>" . $solicitudesAudienciasDto[0]->getCarpetaInv() . "</td>";
                } else {
                    $html .= "<td>N/A</td>";
                }
                $html .= "<td>NUC:</td>";
                if ($solicitudesAudienciasDto[0]->getNuc() != "") {
                    $html .= "<td>" . $solicitudesAudienciasDto[0]->getNuc() . "</td>";
                } else {
                    $html .= "<td>N/A</td>";
                }
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Naturaleza:</td>";
                $html .= "<td>" . $rsDesNaturaleza . "</td>";
                $html .= "<td>&#191;Detenido?</td>";

                $html .= "<td>" . $consignacion . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Usuario que solicit&oacute;:</td>";
                $html .= "<td>" . $nombreSolicitante1 . "</td>";
                $html .= "<td>Estatus:</td>";
                $html .= "<td>" . $rsEstatusAudiencia . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Notas:</td>";
                $html .= "<td colspan='3'>" . utf8_encode($solicitudesAudienciasDto[0]->getObservaciones()) . "</td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE SOLICITUDES AUDIENCIAS////////////////////
//                $html .= "<table border='1' width='100%'>";
                $html .= "<table  class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='4' align='center'><b>DATOS DE LA SOLICITUD</b></td></tr>";
                $html .= "<tr>";
                $html .= "<td width='20%'>Estatus:</td>";
                $html .= "<td width='30%'>" . $rsEstatusSolicitudes . "</td>";
                $html .= "<td width='20%'>&#191;Detenido?</td>";
                $html .= "<td width='30%'>" . $consignacion . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Tipo de audiencia:</td>";
                $html .= "<td>" . $tiposAudiencia . "</td>";
                $html .= "<td>Tipo de naturaleza:</td>";
                $html .= "<td>" . $rsDesNaturaleza . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fase del proceso:</td>";
                $html .= "<td>" . $rsDesEtapaProcesal . "</td>";
                $html .= "<td>Usuario que solicit&oacute;:</td>";
                $html .= "<td>" . $nombreSolicitante1 . "</td>";
                $html .= "</tr>";
                $html .= "<tr>";
                $html .= "<td>Fecha solicitud:</td>";
                $html .= "<td>" . $fechaFroamto . "</td>";
                $html .= "<td>Hora solicitud:</td>";
                $html .= "<td>" . $fecha[1] . "</td>";
                $html .= "</tr>";
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE IMPUTADOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='2' align='center'><b>IMPUTADO(S)</b></td></tr>";
                $imputadosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $imputadosSolicitudesDto->setActivo("S");
                $imputadosSolicitudesDto = $imputadosSolicitudesDao->selectImputadossolicitudes($imputadosSolicitudesDto);
                if ($imputadosSolicitudesDto != "") {
                    foreach ($imputadosSolicitudesDto as $imputado) {
                        $html .= "<tr>";
                        $html .= "<td width='40%'>";
                        if ($imputado->getCveTipoPersona() == 1) {
                            $html .= "Nombre: " . utf8_encode($imputado->getNombre()) . " " . utf8_encode($imputado->getPaterno()) . " " . utf8_encode($imputado->getMaterno());
                        } else {
                            $html .= "Nombre: " . utf8_encode($imputado->getNombreMoral());
                        }

                        $html .= "</td>";
                        $html .= "<td width='60%'>";
                        ////////////////////////////////INGRESO AL CERESO
                        if ($imputado->getDetenido() == 'S') {
                            $html .= '&#191;Detenido?: Si <br>';
                            if ($imputado->getFechaControlDet() != "") {
                                $html .= 'Fecha de ingreso al cereso: ' . $this->fechaHoraNormal($imputado->getFechaControlDet()) . '<br>';
                            } else {
                                $html .= 'Fecha de ingreso al cereso: N/A<br>';
                            }

                            if ($imputado->getCveCereso() != "") {
                                $ceresosDto->setCveCereso($imputado->getCveCereso());
                                $rsCeresosDto = $ceresosDao->selectCeresos($ceresosDto);
                                if ($rsCeresosDto != "") {
                                    $html .= 'Cereso: ' . utf8_decode($rsCeresosDto[0]->getDesCereso()) . '<br>';
                                } else {
                                    $html .= 'Ceresos: N/A<br>';
                                }
                            } else {
                                $html .= 'Ceresos: N/A<br>';
                            }
                        } else {
                            $html .= '&#191;Detenido?: No <br>';
                        }
                        ////////////////////////////////FIN INGRESO AL CERESO
                        $domiciliosimputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                        $domiciliosimputadosDto->setActivo("S");
                        $rsDomiciliosimputadosDto = $domiciliosimputadosDao->selectDomiciliosimputadossolicitudes($domiciliosimputadosDto);
                        if ($rsDomiciliosimputadosDto != "") {
                            foreach ($rsDomiciliosimputadosDto as $domicilioImputado) {
                                $html .= "Domicilio: " . utf8_encode($domicilioImputado->getDireccion());
                                if ($domicilioImputado->getNumExterior() != "") {
                                    $html .= " No. " . utf8_encode($domicilioImputado->getNumExterior());
                                }
                                if ($domicilioImputado->getColonia() != "") {
                                    $html .= " Colonia " . utf8_encode($domicilioImputado->getColonia());
                                }
                                if ($domicilioImputado->getCp() != "") {
                                    $html .= " C.P. " . ($domicilioImputado->getCp());
                                }
                                $html .= "<br>";
                            }
                        }
                        $defensoresImputadosDto->setActivo("S");
                        $defensoresImputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                        $rsDefensoresImputadosDto = $defensoresImputadosDao->selectDefensoresimputadossolicitudes($defensoresImputadosDto);
                        if ($rsDefensoresImputadosDto != "") {
                            foreach ($rsDefensoresImputadosDto as $defensorImputados) {
                                $html .= "Defensor: " . utf8_encode($defensorImputados->getNombre()) . "<br>";
                            }
                        }
                        $html .= "</td>";
                        $html .= "</tr>";
                    }
                }
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE OFENDIDOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='2' align='center'><b>SUJETO(S) PASIVO(S) DEL DELITO</b></td></tr>";
                $ofendidoSolicitudDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $ofendidoSolicitudDto->setActivo("S");
                $ofendidoSolicitudDto = $ofendidoSolicitudDao->selectOfendidossolicitudes($ofendidoSolicitudDto);
                if ($ofendidoSolicitudDto != "") {
                    foreach ($ofendidoSolicitudDto as $ofendido) {
                        $html .= "<tr>";
                        $html .= "<td width='40%'>";
                        if ($ofendido->getCveTipoParte() != "" && $ofendido->getCveTipoParte() != "0") {
                            $tipospartesDto->setCveTipoParte($ofendido->getCveTipoParte());
                            $rsTipospartesDto = $tipospartesDao->selectTipospartes($tipospartesDto);
                            if ($rsTipospartesDto != "") {
                                $tipo = $rsTipospartesDto[0]->getDescTipoParte();
                            } else {
                                $tipo = "OFENDIDO";
                            }
                        } else {
                            $tipo = "OFENDIDO";
                        }

                        if ($ofendido->getCveTipoPersona() == 1) {
                            $html .= "Nombre: " . utf8_encode($ofendido->getNombre()) . " " . utf8_encode($ofendido->getPaterno()) . " " . utf8_encode($ofendido->getMaterno()) . " <b>(" . utf8_encode($tipo) . ")</b>";
                        } else {
                            $html .= "Nombre: " . utf8_encode($ofendido->getNombreMoral()) . " <b>(" . utf8_encode($tipo) . ")</b>";
                        }

                        $html .= "</td>";
                        $html .= "<td width='60%'>";

                        $DomiciliosOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                        $DomiciliosOfendidosDto->setActivo("S");
                        $rsDomiciliosOfendidosDto = $DomiciliosOfendidosDao->selectDomiciliosofendidossolicitudes($DomiciliosOfendidosDto);
                        if ($rsDomiciliosOfendidosDto != "") {
                            foreach ($rsDomiciliosOfendidosDto as $domicilioOfendido) {
                                $html .= "Domicilio: " . ($domicilioOfendido->getDireccion());
                                if ($domicilioOfendido->getNumExterior() != "") {
                                    $html .= " No. " . ($domicilioOfendido->getNumExterior());
                                }
                                if ($domicilioOfendido->getColonia() != "") {
                                    $html .= " Colonia " . ($domicilioOfendido->getColonia());
                                }
                                if ($domicilioOfendido->getCp() != "") {
                                    $html .= " C.P. " . ($domicilioOfendido->getCp());
                                }
                                $html .= "<br>";
                            }
                        }
                        $defensoresOfendidosDto->setActivo("S");
                        $defensoresOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                        $rsDefensoresOfendidosDto = $defensoresOfendidosDao->selectDefensoresofendidossolicitudes($defensoresOfendidosDto);
                        if ($rsDefensoresOfendidosDto != "") {
                            foreach ($rsDefensoresOfendidosDto as $defensorImputados) {
                                $html .= "Defensor: " . ($defensorImputados->getNombre()) . "<br>";
                            }
                        }
                        $html .= "</td>";
                        $html .= "</tr>";
                    }
                }
                $html .= "</table><br>";

                ///////////////////////////////////////TABLA DE DELITOS////////////////////
                $html .= "<table class='tablaPrint' border='1' width='100%'>";
                $html .= "<tr><td colspan='4' align='center'><b>DELITO(S)</b></td></tr>";
                $html .= "<td>";
                $delitosSolicitudesDto->setActivo("S");
                $delitosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $rsDelitosSolicitudesDto = $delitosSolicitudesDao->selectDelitosInner($delitosSolicitudesDto);
                $index = 0;
                if ($rsDelitosSolicitudesDto != "") {
                    foreach ($rsDelitosSolicitudesDto as $delitoSolicitud) {
                        $index ++;
                        $html .= $index . ".- " . utf8_encode($delitoSolicitud->getDesDelito()) . "<br>";
                    }
                }
                $html .= "</td>";
                $html .= "</table><br>";
                $html .= "<script language=\"javascript\">";
                $html .= "window.print();";
                $html .= "</script>";
            } else {
                $html .= "La solicitud no se encuentra enviada.";
            }
        } else {
            $html .= "No se encontro la solicitud audiencia.";
        }

        return $html;
    }

    public function consultaInfoAudiencia($param) {
        $idAudiencia = $param["idAudiencia"];
        $json = "";
        $x = 1;
        $i = 1;
        $d = 1;
        $l = 1;
        $r = 1;
        $audienciasDto = new AudienciasDTO();
        $audienciasDao = new AudienciasDAO();
        $audienciasDto->setIdAudiencia($idAudiencia);


        $audienciasDto = $audienciasDao->selectAudiencias($audienciasDto);
        if ($audienciasDto != "") {

            $solicitudesAudienciasDto = new SolicitudesaudienciasDTO();
            $solicitudesAudienciasDao = new SolicitudesaudienciasDAO();

            $solicitudesAudienciasDto->setIdSolicitudAudiencia($audienciasDto[0]->getIdSolicitudAudiencia());
            $solicitudesAudienciasDto = $solicitudesAudienciasDao->selectSolicitudesaudiencias($solicitudesAudienciasDto);

            if ($solicitudesAudienciasDto != "") {
                $idSolicitudAudiencia = $solicitudesAudienciasDto[0]->getIdSolicitudAudiencia();
                $usuarioWS = new UsuarioCliente();

                $imputadosSolicitudesDto = new ImputadossolicitudesDTO();
                $imputadosSolicitudesDao = new ImputadossolicitudesDAO();

                $ofendidoSolicitudDao = new OfendidossolicitudesDAO();
                $ofendidoSolicitudDto = new OfendidossolicitudesDTO();

                $domiciliosimputadosDto = new DomiciliosimputadossolicitudesDTO();
                $domiciliosimputadosDao = new DomiciliosimputadossolicitudesDAO();

                $DomiciliosOfendidosDto = new DomiciliosofendidossolicitudesDTO();
                $DomiciliosOfendidosDao = new DomiciliosofendidossolicitudesDAO();

                $defensoresImputadosDto = new DefensoresimputadossolicitudesDTO();
                $defensoresImputadosDao = new DefensoresimputadossolicitudesDAO();

                $defensoresOfendidosDto = new DefensoresofendidossolicitudesDTO();
                $defensoresOfendidosDao = new DefensoresofendidossolicitudesDAO();

                $delitosSolicitudesDto = new DelitossolicitudesDTO();
                $delitosSolicitudesDao = new DelitossolicitudesDAO();


                $tipospartesDto = new TipospartesDTO();
                $tipospartesDao = new TipospartesDAO();

                $ceresosDto = new CeresosDTO();
                $ceresosDao = new CeresosDAO();
                ////////////////////////////////////////////////////////////////
                //
                //
                //
                //
                //
                //
                ////////////////////////////Se define el tipo de carpeta
                if ($audienciasDto[0]->getCveTipoCarpeta() != "" && $audienciasDto[0]->getCveTipoCarpeta() != 0) {
                    if ($audienciasDto[0]->getCveTipoCarpeta() == 1) {
                        $numAuxiliar = $audienciasDto[0]->getNumero() . "/" . $audienciasDto[0]->getAnio();
                        $numCausa = "N/A";
                    } else {
                        $numCausa = $audienciasDto[0]->getNumero() . "/" . $audienciasDto[0]->getAnio();
                        $numAuxiliar = "N/A";
                    }
                } else {
                    $numAuxiliar = "N/A";
                    $numCausa = "N/A";
                }



                //Descripci�n de la sala
                $salasDto = new SalasDTO();
                $salasDao = new SalasDAO();
                $salasDto->setCveSala($audienciasDto[0]->getCveSala());
                $salasDto = $salasDao->selectSalas($salasDto);

                if ($salasDto != "") {
                    $rsDesSala = utf8_encode($salasDto[0]->getDesSala());
                } else {
                    $rsDesSala = "N/A";
                }

                ////////////////////////////traer la descripcion de la solicitud
                $catAudiencasDto = new CataudienciasDTO();
                $catAudiencasDao = new CataudienciasDAO();

                $catAudiencasDto->setCveCatAudiencia($audienciasDto[0]->getCveCatAudiencia());
                $rsCatAudienciasDto = $catAudiencasDao->selectCataudiencias($catAudiencasDto);
                if ($rsCatAudienciasDto != "") {
                    $rsDesAudiencia = utf8_encode($rsCatAudienciasDto[0]->getDesCatAudiencia());
                } else {
                    $rsDesAudiencia = "N/A";
                }

                ///////////////////////////Traer la descripcion de la naturaleza
                $naturalezasDto = new NaturalezasDTO();
                $naturalezasDao = new NaturalezasDAO();
                $naturalezasDto->setCveNaturaleza($solicitudesAudienciasDto[0]->getCveNaturaleza());
                $rsNaturalezasDto = $naturalezasDao->selectNaturalezas($naturalezasDto);
                if ($rsNaturalezasDto != "") {
                    $rsDesNaturaleza = utf8_encode($rsNaturalezasDto[0]->getDesNaturaleza());
                } else {
                    $rsDesNaturaleza = "N/A";
                }
                ////definir la consignacion
                if ($solicitudesAudienciasDto[0]->getCveConsignacion() == 1 || $solicitudesAudienciasDto[0]->getCveConsignacion() == 3) {
                    $consignacion = "S";
                } else {
                    $consignacion = "N";
                }
                /////////////////////////////////////Descripcion de la audiencia
                $estatusAudienciasDto = new EstatusaudienciasDTO();
                $estatusAudienciasDao = new EstatusaudienciasDAO();
                $estatusAudienciasDto->setCveEstatusAudiencia($audienciasDto[0]->getCveEstatusAudiencia());
                $rsEstatusAudienciasDto = $estatusAudienciasDao->selectEstatusaudiencias($estatusAudienciasDto);
                if ($rsEstatusAudienciasDto != "") {
                    $rsEstatusAudiencia = utf8_encode($rsEstatusAudienciasDto[0]->getDesEstatusAudiencia());
                } else {
                    $rsEstatusAudiencia = "N/A";
                }

                /////////////////////////////////////Descripcion del estatus de la solicitud
                $estatusSolicitudesDto = new EstatussolicitudesDTO();
                $estatusSolicitudesDao = new EstatussolicitudesDAO();
                $estatusSolicitudesDto->setCveEstatusSolicitud($solicitudesAudienciasDto[0]->getCveEstatusSolicitud());
                $rsEstatusSolicitudesDto = $estatusSolicitudesDao->selectEstatussolicitudes($estatusSolicitudesDto);
                if ($rsEstatusSolicitudesDto != "") {
                    $rsEstatusSolicitudes = utf8_encode($rsEstatusSolicitudesDto[0]->getDesEstatusSolicitud());
                } else {
                    $rsEstatusSolicitudes = "N/A";
                }

                ////////////////////////////////Descripcion del tipo de audiencia
                $tiposAudienciasDto = new TiposaudienciasDTO();
                $tiposAudienciasDao = new TiposaudienciasDAO();

                $tiposAudienciasDto->setCveTipoAudiencia($solicitudesAudienciasDto[0]->getCveTipoAudiencia());
                $rsTiposAudienciasDto = $tiposAudienciasDao->selectTiposaudiencias($tiposAudienciasDto);
                if ($rsTiposAudienciasDto != "") {
                    $tiposAudiencia = utf8_encode($rsTiposAudienciasDto[0]->getDesTipoAudiencia());
                } else {
                    $tiposAudiencia = "N/A";
                }

                //////////////////////////////////////////////////Etapa procesal
                $etapaProcesalDto = new EtapasprocesalesDTO();
                $etapaProcesalDao = new EtapasprocesalesDAO();
                $etapaProcesalDto->setCveEtapaProcesal($solicitudesAudienciasDto[0]->getCveEtapaProcesal());
                $rsEtapaProcesalDto = $etapaProcesalDao->selectEtapasprocesales($etapaProcesalDto);
                if ($rsEtapaProcesalDto != "") {
                    $rsDesEtapaProcesal = utf8_encode($rsEtapaProcesalDto[0]->getDesEtapaProcesal());
                } else {
                    $rsDesEtapaProcesal = "N/A";
                }
                //////fecha y hora de la solicitud
                $fecha = explode(" ", $solicitudesAudienciasDto[0]->getFechaRegistro());
                $fechaFroamto = $this->fechaNormal($fecha[0]);
                ////Nombre de los solicitantes
                $usuario = $usuarioWS->getUsuarios($solicitudesAudienciasDto[0]->getCveUsuario());
                $usuario = json_decode($usuario, true);
                if ($usuario != "") {
                    $nombreSolicitante = utf8_encode($usuario["data"][0]["nombre"] . " " . $usuario["data"][0]["paterno"] . " " . $usuario["data"][0]["materno"]);
                } else {
                    $nombreSolicitante = "N/A";
                }
                $usuario1 = $usuarioWS->getUsuarios($audienciasDto[0]->getCveUsuario());
                $usuario1 = json_decode($usuario1, true);
                if ($usuario1 != "") {
                    $nombreSolicitante1 = utf8_encode($usuario["data"][0]["nombre"] . " " . $usuario["data"][0]["paterno"] . " " . $usuario["data"][0]["materno"]);
                } else {
                    $nombreSolicitante1 = "N/A";
                }


                $json .= "{";
                if ($audienciasDto[0]->getCveTipoCarpeta() == '6') {
                    $json .= '"Toca":' . json_encode(($numCausa)) . ",";
                } else {
                    $json .= '"Causa":' . json_encode(($numCausa)) . ",";
                }

                $json .= '"numAuxiliar":' . json_encode(($numAuxiliar)) . ",";
                $json .= '"cveCatAudiencia":' . json_encode(($rsDesAudiencia)) . ",";
                $json .= '"fechaInicialAudiencia":' . json_encode(($this->fechaHoraNormal($audienciasDto[0]->getFechaInicial()))) . ",";
                $json .= '"fechaFinalAudiencia":' . json_encode(($this->fechaHoraNormal($audienciasDto[0]->getFechaFinal()))) . ",";
                $json .= '"Sala":' . json_encode($rsDesSala) . ",";

                $audienciasJuzgadorDao = new AudienciasjuzgadorDAO();
                $audienciasJuzgadorDto = new AudienciasjuzgadorDTO();
                $audienciasJuzgadorDto->setIdAudiencia($audienciasDto[0]->getIdAudiencia());
                $audienciasJuzgadorDto->setActivo("S");
                $selectAudienciasJuzgadores = $audienciasJuzgadorDao->selectAudienciasjuzgador($audienciasJuzgadorDto);
                $juez = "";
                //////////////////////////////////////////////////////////////////
                if ($selectAudienciasJuzgadores != "") {
                    $juzgadoresDto = new JuzgadoresDTO();
                    $juzgadoresDao = new JuzgadoresDAO();


                    foreach ($selectAudienciasJuzgadores as $audienciasJuzgador) {
                        $juzgadoresDto->setIdJuzgador($audienciasJuzgador->getIdJuzgador());
                        $rsJuzgadoresDto = $juzgadoresDao->selectJuzgadores($juzgadoresDto);
                        if ($rsJuzgadoresDto != "") {
                            $juez .= utf8_encode($rsJuzgadoresDto[0]->getNombre()) . " " . utf8_encode($rsJuzgadoresDto[0]->getPaterno()) . " " . utf8_encode($rsJuzgadoresDto[0]->getMaterno());
                        } else {
                            $juez .= "N/A";
                        }
                    }
                } else {
                    $juez .= "N/A";
                }
                //////////////////////////////////////////////////////////////////
                $json .= '"juez":' . json_encode(($juez)) . ",";
                if ($solicitudesAudienciasDto[0]->getCarpetaInv() != "") {
                    $json .= '"carpetaInv":' . json_encode(($solicitudesAudienciasDto[0]->getCarpetaInv())) . ",";
                } else {
                    $json .= '"carpetaInv":"N/A",';
                }
                if ($solicitudesAudienciasDto[0]->getNuc() != "") {
                    $json .= '"NUC":' . json_encode(($solicitudesAudienciasDto[0]->getNuc())) . ",";
                } else {
                    $json .= '"NUC":"N/A",';
                }
                $json .= '"naturaleza":' . json_encode(($rsDesNaturaleza)) . ",";
                $json .= '"detenido":' . json_encode(($consignacion)) . ",";
                $json .= '"usuarioSolicita":' . json_encode(($nombreSolicitante1)) . ",";
                $json .= '"estatus":' . json_encode(($rsEstatusAudiencia)) . ",";
                $json .= '"notas":' . json_encode(($solicitudesAudienciasDto[0]->getObservaciones())) . ",";
                ///////////////////////////////////////TABLA DE IMPUTADOS////////////////////
                $json .= '"imputados":[';
                $imputadosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $imputadosSolicitudesDto->setActivo("S");
                $imputadosSolicitudesDto = $imputadosSolicitudesDao->selectImputadossolicitudes($imputadosSolicitudesDto);
                if ($imputadosSolicitudesDto != "") {

                    foreach ($imputadosSolicitudesDto as $imputado) {
                        $json .= "{";
                        if ($imputado->getCveTipoPersona() == 1) {
                            $json .= '"Nombre":' . json_encode(utf8_encode($imputado->getNombre()) . " " . utf8_encode($imputado->getPaterno()) . " " . utf8_encode($imputado->getMaterno())) . ",";
                        } else {
                            $json .= '"Nombre":' . json_encode(utf8_encode($imputado->getNombreMoral())) . ",";
                        }

                        ////////////////////////////////INGRESO AL CERESO
                        if ($imputado->getDetenido() == 'S') {
                            $json .= '"detenido":"Si",';
                            if ($imputado->getFechaControlDet() != "") {
                                $json .= '"fechaDetenecion":' . json_encode(($this->fechaHoraNormal($imputado->getFechaControlDet()))) . ",";
                            } else {
                                $json .= '"fechaDetenecion":" N/A",';
                            }

                            if ($imputado->getCveCereso() != "") {
                                $ceresosDto->setCveCereso($imputado->getCveCereso());
                                $rsCeresosDto = $ceresosDao->selectCeresos($ceresosDto);
                                if ($rsCeresosDto != "") {
                                    $json .= '"Cereso":' . json_encode(($rsCeresosDto[0]->getDesCereso())) . ",";
                                } else {
                                    $json .= '"Ceresos":" N/A",';
                                }
                            } else {
                                $json .= '"Ceresos":" N/A",';
                            }
                        } else {
                            $json .= '"detenido":"No",';
                            $json .= '"fechaDetenecion":" N/A",';
                            $json .= '"Ceresos":" N/A",';
                        }
                        ////////////////////////////////FIN INGRESO AL CERESO
                        $defensoresImputadosDto->setActivo("S");
                        $defensoresImputadosDto->setIdImputadoSolicitud($imputado->getIdImputadoSolicitud());
                        $rsDefensoresImputadosDto = $defensoresImputadosDao->selectDefensoresimputadossolicitudes($defensoresImputadosDto);
                        $json .= '"defensor":[';
                        if ($rsDefensoresImputadosDto != "") {
                            foreach ($rsDefensoresImputadosDto as $defensorImputados) {
                                $json .= '{';
                                $json .= '"defensor":' . json_encode(utf8_encode($defensorImputados->getNombre())) . "";
                                $json .= "}" . "\n";
                                $r ++;
                                if ($r <= count($rsDefensoresImputadosDto)) {
                                    $json .= ",";
                                }
                            }
                        }
                        $json .= ']';
                        $json .= "}" . "\n";
                        $x ++;
                        if ($x <= count($imputadosSolicitudesDto)) {
                            $json .= ",";
                        }
                    }
                }
                $json .= '],';
                ///////////////////////////////////////TABLA DE OFENDIDOS////////////////////
                $json .= '"ofendidos":[';
                $ofendidoSolicitudDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $ofendidoSolicitudDto->setActivo("S");
                $ofendidoSolicitudDto = $ofendidoSolicitudDao->selectOfendidossolicitudes($ofendidoSolicitudDto);
                if ($ofendidoSolicitudDto != "") {
                    foreach ($ofendidoSolicitudDto as $ofendido) {
                        $json .= "{";
                        if ($ofendido->getCveTipoParte() != "" && $ofendido->getCveTipoParte() != "0") {
                            $tipospartesDto->setCveTipoParte($ofendido->getCveTipoParte());
                            $rsTipospartesDto = $tipospartesDao->selectTipospartes($tipospartesDto);
                            if ($rsTipospartesDto != "") {
                                $tipo = $rsTipospartesDto[0]->getDescTipoParte();
                            } else {
                                $tipo = "OFENDIDO";
                            }
                        } else {
                            $tipo = "OFENDIDO";
                        }

                        if ($ofendido->getCveTipoPersona() == "1") {
                            $json .= '"Nombre":' . json_encode(($ofendido->getNombre()) . ' ' . utf8_encode($ofendido->getPaterno()) . ' ' . utf8_encode($ofendido->getMaterno()) . '(' . utf8_encode($tipo) . ')') ;
                        } else {
                            $json .= '"Nombre":' . json_encode(utf8_encode($ofendido->getNombreMoral()) . ' - ' . utf8_encode($tipo));
                        }
                        $defensoresOfendidosDto->setActivo("S");
                        $defensoresOfendidosDto->setIdOfendidoSolicitud($ofendido->getIdOfendidoSolicitud());
                        $rsDefensoresOfendidosDto = $defensoresOfendidosDao->selectDefensoresofendidossolicitudes($defensoresOfendidosDto);
                        $json .= ',"defensor":[';
                        if ($rsDefensoresOfendidosDto != "") {
                            $defensor = "";
                            foreach ($rsDefensoresOfendidosDto as $defensorImputados) {
                                $json .= '{';
                                $json .= '"defensor":' . json_encode(utf8_encode($defensorImputados->getNombre())) . "";
                                $json .= "}" . "\n";
                                $l ++;
                                if ($l <= count($rsDefensoresOfendidosDto)) {
                                    $json .= ",";
                                }
                            }
                        }
                        $json .= ']';
                        $json .= "}" . "\n";
                        $i ++;
                        if ($i <= count($ofendidoSolicitudDto)) {
                            $json .= ",";
                        }
                    }
                }
                $json .= '],';
                ///////////////////////////////////////TABLA DE DELITOS////////////////////
                $json .= '"delitos":[';
                $delitosSolicitudesDto->setActivo("S");
                $delitosSolicitudesDto->setIdSolicitudAudiencia($idSolicitudAudiencia);
                $rsDelitosSolicitudesDto = $delitosSolicitudesDao->selectDelitosInner($delitosSolicitudesDto);
                $delito = "";
                if ($rsDelitosSolicitudesDto != "") {
                    foreach ($rsDelitosSolicitudesDto as $delitoSolicitud) {
                        $json .= '{';
                        $json .= '"delito":' . json_encode(utf8_encode($delitoSolicitud->getDesDelito())) . "";
                        $json .= "}" . "\n";
                        $d ++;
                        if ($d <= count($rsDelitosSolicitudesDto)) {
                            $json .= ",";
                        }
                    }
                }
                $json .= ']';
                $json .= '}';
            } else {
                $json .= '{"estatus":"Fail",';
                $json .= '"mnj":"La solicitud no se encuntra enviada."}';
            }
        } else {
            $json .= '{"estatus":"Fail",';
            $json .= '"mnj":"La audiencia no se encontro."}';
        }
        return $json;
    }

    private function fecha($fecha) {
        list($year, $mes, $dia) = explode("-", $fecha);
        return $dia . "/" . $mes . "/" . $year;
    }

    public function fechaHoraNormal($fecha) {
        list ($fechaAux, $hora) = explode(" ", $fecha);
        list($year, $mes, $dia) = explode("-", $fechaAux);

        return $dia . "/" . $mes . "/" . $year . " " . $hora;
    }

    public function fechaNormal($fecha) {
        list($year, $mes, $dia) = explode("-", $fecha);

        return $dia . "/" . $mes . "/" . $year;
    }

}

//$ResumensolicitudaudienciaController = new ResumensolicitudaudienciaController();
//@$param["idAudiencia"] = 686651;
//@$param["idSolicitudAudienca"] = "";
//@$param["mismoJuzgador"] = "N";
//@$param["tribunal"] = "N";
//$rs = $ResumensolicitudaudienciaController->enviarSolicitudAudiencia($param, "");
//print_r($rs);
